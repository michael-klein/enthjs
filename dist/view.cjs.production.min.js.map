{"version":3,"file":"view.cjs.production.min.js","sources":["../src/directive.ts","../src/html.ts","../src/scheduler.ts","../src/render.ts","../src/directives/sub.ts","../src/reactivity.ts","../src/context.ts","../src/misc.ts","../src/sideeffects.ts","../src/attributes.ts","../src/directives/text.ts","../src/directives/input.ts","../src/directives/on.ts","../src/properties.ts","../src/component.ts"],"sourcesContent":["export type DirectiveGenerator<Args extends any[] = any[]> = Generator<\n  any,\n  void,\n  Args\n>;\n\nexport type DirectiveGeneratorFactory<\n  N extends Node = Node,\n  Args extends any[] = any[]\n> = (node: N, ...initialArgs: Args) => DirectiveGenerator<Args>;\nexport interface DirectiveResult<\n  N extends Node = Node,\n  Args extends any[] = any[]\n> {\n  factory: DirectiveGeneratorFactory<N, Args>;\n  args: Args;\n}\nexport type Directive<N extends Node = Node, Args extends any[] = any[]> = (\n  ...args: Args\n) => DirectiveResult<N, Args>;\nexport const IS_DIRECTIVE = Symbol('directive');\nexport function createDirective<\n  Args extends any[],\n  N extends Node = any,\n  F extends DirectiveGeneratorFactory<N, Args> = DirectiveGeneratorFactory<\n    N,\n    Args\n  >\n>(\n  factory: F\n): F extends (node: N, ...initialArgs: infer A) => DirectiveGenerator<any>\n  ? Directive<N, A>\n  : never {\n  return ((factory: F) => {\n    const directive = function(...args: Args) {\n      return {\n        is: IS_DIRECTIVE,\n        factory,\n        args,\n      };\n    } as any;\n    return directive;\n  })(factory);\n}\n","import { IS_DIRECTIVE, DirectiveResult } from './directive';\n\nconst isLetter = (c: string): boolean => {\n  return c.toLowerCase() != c.toUpperCase();\n};\n\nexport enum DirectiveType {\n  TEXT,\n  ATTRIBUTE,\n  ATTRIBUTE_VALUE,\n}\nexport interface DirectiveData {\n  d: DirectiveResult;\n  t?: DirectiveType;\n  a?: string;\n}\nconst insertAttributeMarker = (\n  marker: string,\n  si: number,\n  appendedStatic: string\n): string => {\n  while (si++) {\n    const char = appendedStatic.charAt(si);\n    if (!char) {\n      break;\n    }\n    if (char === ' ') {\n      return (\n        appendedStatic.slice(0, si) + ' ' + marker + appendedStatic.slice(si)\n      );\n    }\n  }\n  return appendedStatic;\n};\nexport const getTextMarker = (id: number): string => {\n  return `tm-${id}`;\n};\nexport const getAttributeMarker = (id: number): string => {\n  return `data-am-${id}`;\n};\nexport interface HTMLResult {\n  template: HTMLTemplateElement;\n  directives: DirectiveData[];\n}\nfunction isDirective(thing: any): boolean {\n  return thing.is && thing.is === IS_DIRECTIVE;\n}\nlet resultCache: WeakMap<TemplateStringsArray, HTMLResult> = new WeakMap();\nexport const html = (\n  staticParts: TemplateStringsArray,\n  ...dynamicParts: any[]\n): HTMLResult => {\n  let result: HTMLResult = resultCache.get(staticParts);\n  if (!result) {\n    let appendedStatic: string = '';\n    const directives: DirectiveData[] = [];\n    for (let i = 0; i < dynamicParts.length; i++) {\n      const dynamicPart = dynamicParts[i];\n      const staticPart = staticParts[i];\n      appendedStatic += staticPart;\n      if (!isDirective(dynamicPart)) {\n        appendedStatic += dynamicPart;\n        continue;\n      }\n      let id =\n        directives.push({\n          d: dynamicPart,\n        }) - 1;\n      let si = appendedStatic.length + 1;\n      let attributeValueMode = false;\n      let attributeMode = false;\n      let attributeNameFound = false;\n      let attributeName = '';\n      while (si--) {\n        const char = appendedStatic.charAt(si);\n        const nextChar = appendedStatic.charAt(si - 1);\n        const nextNextChar = appendedStatic.charAt(si - 2);\n        if (char === '>' || si === 0) {\n          let marker = getTextMarker(id);\n          appendedStatic += `<${marker}>&zwnj;</${marker}>`;\n          directives[id].t = DirectiveType.TEXT;\n          break;\n        }\n        if (\n          char === '\"' &&\n          nextChar === '=' &&\n          isLetter(nextNextChar) &&\n          !attributeMode\n        ) {\n          attributeValueMode = true;\n          continue;\n        }\n        if (char === '\"' && nextNextChar !== '=' && !attributeValueMode) {\n          attributeValueMode = false;\n          attributeMode = true;\n          continue;\n        }\n        if (\n          attributeValueMode &&\n          char !== '\"' &&\n          char !== '=' &&\n          !attributeNameFound\n        ) {\n          if (char !== ' ') {\n            attributeName = char + attributeName;\n          } else {\n            attributeNameFound = true;\n          }\n        }\n        if (char === '<' && attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE_VALUE;\n          directives[id].a = attributeName;\n          if (appendedStatic[appendedStatic.length - 1] === ' ') {\n            appendedStatic = appendedStatic.slice(0, appendedStatic.length - 1);\n          }\n          break;\n        }\n        if (char === '<' && !attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE;\n          break;\n        }\n      }\n    }\n    appendedStatic += staticParts[staticParts.length - 1];\n    const template = document.createElement('template');\n    template.innerHTML = appendedStatic;\n    result = {\n      template,\n      directives,\n    };\n  } else {\n    let directiveIndex: number = 0;\n    dynamicParts.forEach((value: any) => {\n      if (isDirective(value)) {\n        result.directives[directiveIndex].d = value;\n        directiveIndex++;\n      }\n    });\n  }\n  resultCache.set(staticParts, result);\n  return result;\n};\n","export enum PriorityLevel {\n  IMMEDIATE = 0, //synchronous\n  USER_BLOCKING = 250, //.25s timeout\n  NORMAL = 5000, // 5s timeout\n  LOW = 10000, // 10s timeout\n  IDLE = 99999999, // no timeout (run only when nothing else is scheduled)\n}\ntype ScheduledJob = [() => void, number];\nlet scheduledJobs: ScheduledJob[] = [];\nlet schedulerRunning: boolean = false;\nconst MAX_ELAPSED: number = 17;\nconst processJobQueue = (\n  queue: ScheduledJob[],\n  now: number\n): ScheduledJob[] => {\n  let index = 0;\n  for (let length = queue.length; index < length; index++) {\n    const totalElapsed: number = Date.now() - now;\n    const [cb, latestEndTime] = queue[index];\n    if (now >= latestEndTime || totalElapsed < MAX_ELAPSED) {\n      cb();\n    } else {\n      break;\n    }\n  }\n  return queue.slice(index);\n};\nconst processScheduledJobs = () => {\n  const now: number = Date.now();\n  scheduledJobs = processJobQueue(\n    scheduledJobs.sort((a, b) => (a[1] < b[1] ? -1 : 1)),\n    now\n  );\n  if (scheduledJobs.length > 0) {\n    requestAnimationFrame(processScheduledJobs);\n  } else {\n    schedulerRunning = false;\n  }\n};\nexport const schedule = (\n  cb: () => void,\n  priority: PriorityLevel = PriorityLevel.NORMAL\n): Promise<void> => {\n  if (priority === PriorityLevel.IMMEDIATE) {\n    cb();\n  } else {\n    return new Promise(resolve => {\n      scheduledJobs.push([\n        () => {\n          cb();\n          resolve();\n        },\n        Date.now() + priority,\n      ]);\n      if (!schedulerRunning) {\n        requestAnimationFrame(processScheduledJobs);\n        schedulerRunning = true;\n      }\n    });\n  }\n  return Promise.resolve();\n};\nexport type Schedule = typeof schedule;\n","import {\n  HTMLResult,\n  DirectiveType,\n  getTextMarker,\n  getAttributeMarker,\n} from './html';\nimport { DirectiveGenerator } from './directive';\n\nconst renderedNodesMap: WeakMap<HTMLElement, Node[]> = new WeakMap();\nexport const clear = (container: HTMLElement) => {\n  if (renderedNodesMap.has(container)) {\n    renderedNodesMap\n      .get(container)\n      .forEach(node => container.removeChild(node));\n    renderedNodesMap.delete(container);\n  }\n};\nconst generatorMap: WeakMap<HTMLElement, DirectiveGenerator[]> = new WeakMap();\nexport const render = (\n  container: HTMLElement,\n  htmlResult: HTMLResult\n): void => {\n  let fragment: DocumentFragment;\n  if (!renderedNodesMap.has(container)) {\n    const generators: DirectiveGenerator[] = [];\n    generatorMap.set(container, generators);\n    fragment = htmlResult.template.content.cloneNode(true) as DocumentFragment;\n    htmlResult.directives.forEach((directiveData, id) => {\n      switch (directiveData.t) {\n        case DirectiveType.TEXT:\n          const placeholder = fragment.querySelector(getTextMarker(id));\n          const textNode = placeholder.firstChild;\n          generators[id] = directiveData.d.factory(\n            textNode,\n            ...directiveData.d.args\n          );\n          placeholder.parentElement.replaceChild(textNode, placeholder);\n          break;\n        case DirectiveType.ATTRIBUTE:\n        case DirectiveType.ATTRIBUTE_VALUE:\n          const marker = getAttributeMarker(id);\n          const node = fragment.querySelector(`[${marker}]`);\n          generators[id] = directiveData.d.factory(\n            node,\n            ...directiveData.d.args\n          );\n          node.removeAttribute(marker);\n      }\n    });\n    renderedNodesMap.set(container, Array.from(fragment.childNodes));\n  }\n\n  const generators: DirectiveGenerator[] = generatorMap.get(container);\n  htmlResult.directives.forEach((directiveData, id) => {\n    generators[id].next(directiveData.d.args);\n  });\n  if (fragment) {\n    container.appendChild(fragment);\n  }\n};\n","import { createDirective } from '../directive';\nimport { PriorityLevel, schedule } from '../scheduler';\nimport { HTMLResult } from '../html';\nimport { clear, render } from '../render';\n\nexport const sub = createDirective(function*(node: Text, cb: () => HTMLResult) {\n  let span: HTMLSpanElement;\n  if (node.nodeType === 3) {\n    span = document.createElement('span');\n    node.parentElement.insertBefore(span, node);\n    node.parentElement.removeChild(node);\n    for (;;) {\n      schedule(() => {\n        clear(span as HTMLElement);\n        render(span as HTMLElement, cb());\n      }, PriorityLevel.USER_BLOCKING);\n      cb = (yield)[0];\n    }\n  }\n});\n","const IS_PROXY = Symbol('$P');\nfunction proxify(obj: any, onChange: () => void): any {\n  const proxy = new Proxy(obj, {\n    get: (obj, prop) => {\n      if (\n        obj[prop] &&\n        typeof obj[prop] === 'object' &&\n        obj[prop].__$p !== IS_PROXY\n      ) {\n        obj[prop] = proxify(obj[prop], onChange);\n      }\n      return obj[prop];\n    },\n    set: (obj, prop, value) => {\n      if (obj[prop] !== value && prop !== '__$p') {\n        obj[prop] = value;\n        onChange();\n      }\n      return true;\n    },\n  });\n  proxy.__$p = IS_PROXY;\n  return proxy;\n}\nlet onStateChanged: () => void;\nexport const setUpState = <CB extends () => any>(\n  cb: CB,\n  onChange: () => void\n): ReturnType<CB> => {\n  onStateChanged = onChange;\n  let result = cb();\n  onStateChanged = undefined;\n  return result;\n};\nexport const $state = <S extends {} = {}>(initialState: Partial<S> = {}): S => {\n  let onChange = onStateChanged;\n  return proxify(initialState, () => onChange && onChange());\n};\n","import { getOnlySetupError } from './misc';\n\nconst global: { __$c: HTMLElement } = window as any;\n\nexport const setUpContext = (context: HTMLElement, cb: () => void): void => {\n  global.__$c = context;\n  cb();\n  global.__$c = undefined;\n};\n\nexport const getElement = (): HTMLElement => {\n  if (global.__$c) {\n    return global.__$c;\n  } else {\n    throw getOnlySetupError('getElement');\n  }\n};\n","export const getOnlySetupError = (subject: string): string =>\n  `${subject} can only be used during setup!`;\n","import { getElement } from './context';\nimport { schedule, PriorityLevel } from './scheduler';\n\nexport type CleanUp = () => void;\nexport type SideEffect = () => void | CleanUp;\ninterface SideEffectsMapItem {\n  e: SideEffect;\n  d?: () => any[];\n  p?: any[];\n  c?: CleanUp;\n}\nconst sideEffectsMap: WeakMap<\n  HTMLElement,\n  SideEffectsMapItem[]\n> = new WeakMap();\n\nexport const sideEffect = (effect: () => void, dependencies?: () => any[]) => {\n  const element = getElement();\n  sideEffectsMap.set(\n    element,\n    (sideEffectsMap.get(element) || []).concat({\n      e: effect,\n      d: dependencies,\n    })\n  );\n};\nconst shouldEffectRun = (effectMapItem: SideEffectsMapItem): boolean => {\n  const { d, p } = effectMapItem;\n  let shouldRun: boolean = true;\n  if (d) {\n    const deps = d();\n    if (\n      p &&\n      (deps === p ||\n        (deps.length === p.length &&\n          deps.findIndex((dep, index) => p[index] !== dep))) === -1\n    ) {\n      shouldRun = false;\n    }\n  }\n  return shouldRun;\n};\nexport const runSideEffects = (element: HTMLElement): Promise<void[]> => {\n  const sideEffects = sideEffectsMap.get(element) || [];\n  if (sideEffects.length > 0) {\n    return Promise.all(\n      sideEffects\n        .map(effectMapItem => {\n          const { c } = effectMapItem;\n          if (c && shouldEffectRun(effectMapItem)) {\n            return schedule(() => {\n              c();\n              effectMapItem.c = undefined;\n            }, PriorityLevel.USER_BLOCKING);\n          }\n          return undefined;\n        })\n        .filter(p => p)\n    ).then(() =>\n      Promise.all(\n        sideEffects\n          .map(effectMapItem => {\n            const { e, d } = effectMapItem;\n            let shouldRun: boolean = shouldEffectRun(effectMapItem);\n            if (d) {\n              effectMapItem.p = d();\n            }\n            if (shouldRun) {\n              return schedule(() => {\n                const cleanUp = e();\n                if (cleanUp) {\n                  effectMapItem.c = cleanUp;\n                }\n              }, PriorityLevel.USER_BLOCKING);\n            }\n            return undefined;\n          })\n          .filter(p => p)\n      )\n    );\n  } else {\n    return Promise.resolve([]);\n  }\n};\n","import { $state } from './reactivity';\nimport { getElement } from './context';\nimport { sideEffect } from './sideeffects';\n\nconst attributeCallbackMap: WeakMap<\n  HTMLElement,\n  { [key: string]: (() => void)[] }\n> = new Map();\nconst observerMap: WeakMap<HTMLElement, MutationObserver> = new WeakMap();\n\nconst addObserver = (element: HTMLElement): void => {\n  if (!observerMap.has(element)) {\n    const observer = new MutationObserver((mutationsList: MutationRecord[]) => {\n      for (const mutation of mutationsList) {\n        if (mutation.type === 'attributes') {\n          const callbacks =\n            (attributeCallbackMap.get(element) || {})[mutation.attributeName] ||\n            [];\n          callbacks.forEach(cb => cb());\n        }\n      }\n    });\n    observerMap.set(element, observer);\n  }\n};\n\nconst startObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).observe(element, { attributes: true });\n  }\n};\n\nconst stopObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).disconnect();\n  }\n};\n\nconst observeAttribute = (\n  element: HTMLElement,\n  name: string,\n  cb: () => void\n): void => {\n  if (!attributeCallbackMap.has(element)) {\n    attributeCallbackMap.set(element, {});\n  }\n  if (!attributeCallbackMap.get(element)[name]) {\n    attributeCallbackMap.get(element)[name] = [];\n  }\n  attributeCallbackMap.get(element)[name].push(cb);\n};\n\nexport const $attr = (\n  name: string,\n  initialValue: string = ''\n): { value: string } => {\n  const element = getElement();\n  addObserver(element);\n  observeAttribute(element, name, () => {\n    const value = element.getAttribute(name);\n    if (state.value !== value) {\n      state.value = element.getAttribute(name);\n    }\n  });\n\n  element.setAttribute(name, initialValue);\n\n  const state = $state({ value: element.getAttribute(name) });\n\n  sideEffect(\n    () => {\n      stopObserving(element);\n      element.setAttribute(name, state.value);\n      startObserving(element);\n    },\n    () => [state.value]\n  );\n\n  return state;\n};\n","import { createDirective } from '../directive';\n\nexport const text = createDirective(function*(node: Text, value: string) {\n  for (;;) {\n    node.textContent = value;\n    value = (yield)[0];\n  }\n});\n","import { createDirective } from '../directive';\nimport { PriorityLevel, schedule } from '../scheduler';\n\nexport const input = createDirective(function*(\n  node: HTMLElement,\n  cb: (value: string) => void\n) {\n  const cbRef = {\n    cb,\n  };\n  node.addEventListener('input', e => {\n    const value: string = (e.target as HTMLInputElement).value;\n    schedule(() => cbRef.cb(value), PriorityLevel.NORMAL);\n  });\n  for (;;) {\n    cbRef.cb = (yield)[0];\n  }\n});\n","import { createDirective } from '../directive';\nimport { PriorityLevel, schedule } from '../scheduler';\n\nexport const on = createDirective(function*(\n  node: HTMLElement,\n  name: string,\n  cb: <E extends Event>(e: E) => void\n) {\n  const cbRef = {\n    cb,\n  };\n  node.addEventListener(name, e => {\n    schedule(() => cbRef.cb(e), PriorityLevel.IMMEDIATE);\n  });\n  for (;;) {\n    cbRef.cb = (yield)[1];\n  }\n});\n","import { getElement } from './context';\nimport { $state } from './reactivity';\n\nexport const $prop = <T>(name: string, initialValue: T): { value: T } => {\n  const element = getElement() as any;\n  const state = $state({ value: initialValue });\n  Object.defineProperty(element, name, {\n    get: () => state.value,\n    set: (value: any) => {\n      state.value = value;\n    },\n  });\n  return state;\n};\n","import { HTMLResult } from './html';\nimport { setUpState } from './reactivity';\nimport { render } from './render';\nimport { schedule, PriorityLevel } from './scheduler';\nimport { setUpContext } from './context';\nimport { runSideEffects } from './sideeffects';\nexport interface ComponentDefinition {\n  render: () => HTMLResult;\n}\nexport type Setup = () => ComponentDefinition;\nexport const component = (name: string, setup: Setup) => {\n  customElements.define(\n    name,\n    class extends HTMLElement {\n      private renderQueued: boolean = false;\n      private nextRenderQueued: boolean = false;\n      private render: () => HTMLResult;\n      constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n\n        setUpContext(this, () =>\n          setUpState(\n            () => (this.render = setup().render),\n            () => {\n              this.performRender();\n            }\n          )\n        );\n        this.performRender();\n      }\n\n      private performRender() {\n        if (!this.renderQueued) {\n          this.renderQueued = true;\n          schedule(() => {\n            render(this.shadowRoot as any, this.render());\n          }, PriorityLevel.USER_BLOCKING)\n            .then(async () => await runSideEffects(this))\n            .then(() => {\n              this.renderQueued = false;\n              if (this.nextRenderQueued) {\n                this.nextRenderQueued = false;\n                this.performRender();\n              }\n            });\n        } else {\n          this.nextRenderQueued = true;\n        }\n      }\n    }\n  );\n};\n"],"names":["IS_DIRECTIVE","Symbol","createDirective","factory","args","is","DirectiveType","isLetter","c","toLowerCase","toUpperCase","insertAttributeMarker","marker","si","appendedStatic","char","charAt","slice","getTextMarker","id","getAttributeMarker","isDirective","thing","PriorityLevel","resultCache","WeakMap","renderedNodesMap","generatorMap","render","container","htmlResult","fragment","has","generators","set","template","content","cloneNode","directives","forEach","directiveData","t","TEXT","placeholder","querySelector","textNode","firstChild","d","parentElement","replaceChild","ATTRIBUTE","ATTRIBUTE_VALUE","node","removeAttribute","Array","from","childNodes","get","next","appendChild","scheduledJobs","schedulerRunning","processScheduledJobs","now","Date","queue","index","length","totalElapsed","cb","processJobQueue","sort","a","b","requestAnimationFrame","schedule","priority","NORMAL","IMMEDIATE","Promise","resolve","push","sub","regeneratorRuntime","nodeType","span","document","createElement","insertBefore","removeChild","USER_BLOCKING","onStateChanged","IS_PROXY","setUpState","onChange","result","undefined","$state","initialState","proxify","obj","proxy","Proxy","prop","__$p","value","global","window","setUpContext","context","__$c","getElement","subject","sideEffectsMap","sideEffect","effect","dependencies","element","concat","e","shouldEffectRun","effectMapItem","p","shouldRun","deps","findIndex","dep","attributeCallbackMap","Map","observerMap","text","textContent","input","cbRef","addEventListener","target","on","name","initialValue","observer","MutationObserver","mutationsList","mutation","type","attributeName","addObserver","observeAttribute","getAttribute","state","setAttribute","disconnect","stopObserving","observe","attributes","startObserving","Object","defineProperty","setup","customElements","define","attachShadow","mode","_this","performRender","this","renderQueued","nextRenderQueued","_this2","shadowRoot","then","sideEffects","all","map","filter","cleanUp","HTMLElement","staticParts","dynamicParts","directiveIndex","i","dynamicPart","staticPart","attributeValueMode","attributeMode","attributeNameFound","nextChar","nextNextChar","innerHTML"],"mappings":"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"}