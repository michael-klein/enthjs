{"version":3,"file":"enthjs.cjs.development.js","sources":["../src/reactivity/reactivity.ts","../src/dom/directive.ts","../src/dom/html.ts","../src/scheduler/scheduler.ts","../src/dom/render.ts","../src/dom/component.ts","../src/dom/create_event.ts","../src/dom/directives/text.ts","../src/dom/directives/clss.ts","../src/dom/directives/attr.ts","../src/dom/directives/on.ts","../src/dom/directives/prop.ts","../src/dom/directives/input.ts","../src/dom/directives/sub.ts","../src/dom/directives/frag.ts","../src/dom/directives/list.ts","../src/dom/default_fallback.ts"],"sourcesContent":["const isProxyMap: WeakSet<object> = new WeakSet();\nexport function proxify(\n  obj: any,\n  onChange: () => void,\n  hooks: {\n    set?: (obj: any, prop: string | number | symbol, value: any) => any;\n    get?: (obj: any, prop: string | number | symbol) => void;\n  } = {}\n): any {\n  let initialized = false;\n  let onChangeWrapped = () => {\n    if (initialized) {\n      onChange();\n    }\n  };\n  Object.keys(obj).forEach(key => {\n    if (typeof obj[key] === 'object' && !isProxyMap.has(obj[key])) {\n      obj[key] = proxify(obj[key], onChange);\n    }\n  });\n  const proxy = new Proxy(obj as any, {\n    get: (obj, prop) => {\n      if (hooks.get) {\n        hooks.get(obj, prop);\n      }\n      return obj[prop];\n    },\n    set: (obj, prop, value) => {\n      if (hooks.set) {\n        value = hooks.set(obj, prop, value);\n      }\n      if (typeof value === 'object' && !isProxyMap.has(value)) {\n        console.log('proxify');\n        value = proxify(value, onChangeWrapped);\n      }\n      if (\n        (obj[prop] !== value || !initialized) &&\n        prop !== '__$p' &&\n        prop !== 'on'\n      ) {\n        obj[prop] = value;\n        onChangeWrapped();\n      }\n      obj[prop] = value;\n      return true;\n    },\n  });\n  isProxyMap.add(proxy);\n  initialized = true;\n  return proxy;\n}\nexport type State<S extends {} = {}> = S & {\n  on: (listener: (value: S) => void) => () => void;\n  merge: (otherState: State<Partial<S>>) => void;\n};\n\nexport const $state = <S extends {} = {}>(\n  initialState: Partial<S> = {}\n): State<S> => {\n  let listeners: ((value: S) => void)[] = [];\n  let canEmit = true;\n  const proxy = proxify(initialState, () => {\n    if (canEmit) {\n      listeners.forEach(l => l(proxy));\n    }\n  });\n  proxy.on = (listener: (value: S) => void): (() => void) => {\n    listeners.push(listener);\n    return () => {\n      const index = listeners.indexOf(listener);\n      if (index > 1) {\n        listeners.splice(index, 1);\n      }\n    };\n  };\n  proxy.merge = (otherState: State<Partial<S>>) => {\n    const performMerge = (value: Partial<S>) => {\n      Object.keys(value).forEach(key => {\n        if (!['on', 'merge'].includes(key)) {\n          proxy[key] = (value as any)[key];\n        }\n      });\n    };\n    otherState.on(value => {\n      performMerge(value);\n    });\n    canEmit = false;\n    performMerge(otherState);\n    canEmit = true;\n  };\n  return proxy;\n};\n","import { DirectiveType } from './html';\n\nexport interface DOMUpdate {\n  node: Node;\n  newNode?: Node;\n  type: DOMUpdateType;\n  value?: string;\n  name?: string;\n}\nexport enum DOMUpdateType {\n  TEXT,\n  REPLACE_NODE,\n  ADD_NODE,\n  PREPEND_NODE,\n  INSERT_BEFORE,\n  INSERT_AFTER,\n  REMOVE,\n  ADD_CLASS,\n  REMOVE_CLASS,\n  SET_ATTRIBUTE,\n  CUSTOM,\n}\n\nexport type DirectiveGenerator<Args extends any[] = any[]> =\n  | Generator<DOMUpdate[] | Promise<DOMUpdate[]> | void, void, Args>\n  | AsyncGenerator<DOMUpdate[] | Promise<DOMUpdate[]> | void, void, Args>;\nexport interface DirectiveGeneratorFactoryThis {\n  type: DirectiveType;\n  container: Node;\n}\nexport type DirectiveGeneratorFactory<\n  N extends Node = Node,\n  Args extends any[] = any[]\n> = (\n  this: DirectiveGeneratorFactoryThis,\n  node: N,\n  ...initialArgs: Args\n) => DirectiveGenerator<Args>;\nexport const IS_DIRECTIVE = Symbol.for('directive');\nexport interface DirectiveResult<\n  N extends Node = any,\n  Args extends any[] = any\n> {\n  [IS_DIRECTIVE]: true;\n  factory: DirectiveGeneratorFactory<N, Args>;\n  args: Args;\n  directive: Directive;\n}\nexport type Directive<N extends Node = Node, Args extends any[] = any[]> = (\n  ...args: Args\n) => DirectiveResult<N, Args>;\nexport function createDirective<\n  Args extends any[],\n  N extends Node = any,\n  F extends DirectiveGeneratorFactory<N, Args> = DirectiveGeneratorFactory<\n    N,\n    Args\n  >\n>(\n  factory: F\n): F extends (node: N, ...initialArgs: infer A) => DirectiveGenerator<any>\n  ? Directive<N, A>\n  : never {\n  return ((factory: F) => {\n    const directive = function(...args: Args) {\n      return {\n        [IS_DIRECTIVE]: true,\n        factory,\n        args,\n        directive,\n      };\n    } as any;\n    return directive;\n  })(factory);\n}\n","import { IS_DIRECTIVE, DirectiveResult } from './directive';\n\nconst isLetter = (c: string): boolean => {\n  return c.toLowerCase() != c.toUpperCase();\n};\n\nexport enum DirectiveType {\n  TEXT,\n  ATTRIBUTE,\n  ATTRIBUTE_VALUE,\n}\n\nexport interface DynamicData {\n  directive?: DirectiveResult;\n  staticValue?: any;\n  marker?: string;\n  type?: DirectiveType;\n  attribute?: string;\n  dx?: number;\n  staticParts: TemplateStringsArray;\n}\n\nexport const getTextMarker = (id: number): string => {\n  return `tm-${id}`;\n};\n\nexport const getAttributeMarker = (id: number): string => {\n  return `data-am-${id}`;\n};\nexport const IS_HTML_RESULT = Symbol.for('html_result');\nexport interface HTMLResult {\n  dynamicData: DynamicData[];\n  staticParts: TemplateStringsArray;\n  key?: string;\n  [IS_HTML_RESULT]: true;\n  template?: HTMLTemplateElement;\n}\nexport type HTML = typeof html;\nexport function isDirective(thing: any): boolean {\n  return typeof thing === 'object' && thing[IS_DIRECTIVE];\n}\nlet resultCache: WeakMap<TemplateStringsArray, HTMLResult> = new WeakMap();\nexport const html = (\n  staticParts: TemplateStringsArray,\n  ...dynamicParts: any[]\n): HTMLResult => {\n  let result: HTMLResult = resultCache.get(staticParts);\n  if (!result) {\n    let appendedStatic: string = '';\n    const dynamicData: DynamicData[] = [];\n    for (let i = 0; i < dynamicParts.length; i++) {\n      const dynamicPart = dynamicParts[i];\n      const staticPart = staticParts[i];\n      appendedStatic += staticPart;\n      let dx: number = 0;\n      let id = dynamicData.push({ staticParts }) - 1;\n      const currentDynamicData: DynamicData = dynamicData[id];\n      if (isDirective(dynamicPart)) {\n        currentDynamicData.directive = dynamicPart;\n      } else {\n        currentDynamicData.staticValue = dynamicPart;\n      }\n      let si = appendedStatic.length + 1;\n      let attributeValueMode = false;\n      let attributeMode = false;\n      let attributeNameFound = false;\n      let attributeName = '';\n      while (si--) {\n        dx++;\n        const char = appendedStatic.charAt(si);\n        const nextChar = appendedStatic.charAt(si - 1);\n        const nextNextChar = appendedStatic.charAt(si - 2);\n        if (char === '>' || si === 0) {\n          let marker = getTextMarker(id);\n          currentDynamicData.marker = `<${marker}>&zwnj;</${marker}>`;\n          currentDynamicData.type = DirectiveType.TEXT;\n          break;\n        }\n        if (\n          char === '\"' &&\n          nextChar === '=' &&\n          isLetter(nextNextChar) &&\n          !attributeMode\n        ) {\n          attributeValueMode = true;\n          continue;\n        }\n        if (char === '\"' && nextNextChar !== '=' && !attributeValueMode) {\n          attributeValueMode = false;\n          attributeMode = true;\n          continue;\n        }\n        if (\n          attributeValueMode &&\n          char !== '\"' &&\n          char !== '=' &&\n          !attributeNameFound\n        ) {\n          if (char !== ' ') {\n            attributeName = char + attributeName;\n          } else {\n            attributeNameFound = true;\n          }\n        }\n        if (char === '<' && attributeValueMode) {\n          currentDynamicData.marker = getAttributeMarker(id);\n          currentDynamicData.type = DirectiveType.ATTRIBUTE_VALUE;\n          currentDynamicData.attribute = attributeName;\n          break;\n        }\n        if (char === '<' && !attributeValueMode) {\n          currentDynamicData.marker = getAttributeMarker(id);\n          currentDynamicData.type = DirectiveType.ATTRIBUTE;\n          break;\n        }\n      }\n      currentDynamicData.dx = dx;\n    }\n    appendedStatic += staticParts[staticParts.length - 1];\n    result = {\n      dynamicData,\n      staticParts,\n      [IS_HTML_RESULT]: true,\n    };\n    resultCache.set(staticParts, result);\n  } else {\n    result = {\n      ...result,\n      dynamicData: result.dynamicData.map((data, id) => {\n        if (!isDirective(dynamicParts[id])) {\n          return {\n            ...data,\n            directive: undefined,\n            staticValue: dynamicParts[id],\n          };\n        } else {\n          return {\n            ...data,\n            staticValue: undefined,\n            directive: dynamicParts[id],\n          };\n        }\n      }),\n    };\n  }\n  return result;\n};\n","export enum PriorityLevel {\n  IMMEDIATE = 0, //synchronous\n  USER_BLOCKING = 250, //.25s timeout\n  NORMAL = 5000, // 5s timeout\n  LOW = 10000, // 10s timeout\n  IDLE = 99999999, // no timeout (run only when nothing else is scheduled)\n}\ntype ScheduledJob = [() => void, number];\nlet scheduledJobs: ScheduledJob[] = [];\nlet schedulerRunning: boolean = false;\nconst MAX_ELAPSED: number = 17;\nconst processJobQueue = (\n  queue: ScheduledJob[],\n  now: number\n): ScheduledJob[] => {\n  let index = 0;\n  for (let length = queue.length; index < length; index++) {\n    const totalElapsed: number = Date.now() - now;\n    const [cb, latestEndTime] = queue[index];\n    if (now >= latestEndTime || totalElapsed < MAX_ELAPSED) {\n      cb();\n    } else {\n      break;\n    }\n  }\n  return queue.slice(index);\n};\nconst processScheduledJobs = () => {\n  const now: number = Date.now();\n  console.log(scheduledJobs.length);\n  scheduledJobs = processJobQueue(\n    scheduledJobs.sort((a, b) => (a[1] < b[1] ? -1 : 1)),\n    now\n  );\n  if (scheduledJobs.length > 0) {\n    requestAnimationFrame(processScheduledJobs);\n  } else {\n    schedulerRunning = false;\n  }\n};\nexport const schedule = (\n  cb: () => void,\n  priority: PriorityLevel = PriorityLevel.NORMAL\n): Promise<void> => {\n  if (priority === PriorityLevel.IMMEDIATE) {\n    cb();\n  } else {\n    return new Promise(resolve => {\n      scheduledJobs.push([\n        () => {\n          cb();\n          resolve();\n        },\n        Date.now() + priority,\n      ]);\n      if (!schedulerRunning) {\n        requestAnimationFrame(processScheduledJobs);\n        schedulerRunning = true;\n      }\n    });\n  }\n  return Promise.resolve();\n};\nexport type Schedule = typeof schedule;\n","import {\n  HTMLResult,\n  DirectiveType,\n  getTextMarker,\n  getAttributeMarker,\n  DynamicData,\n} from './html';\nimport { DOMUpdateType, DirectiveGenerator } from './directive';\nimport { schedule, PriorityLevel } from '../scheduler/scheduler';\n\nconst renderedNodesMap: WeakMap<Node, Node[]> = new WeakMap();\nexport const clear = (container: HTMLElement) => {\n  if (renderedNodesMap.has(container)) {\n    renderedNodesMap\n      .get(container)\n      .forEach(node => container.removeChild(node));\n    renderedNodesMap.delete(container);\n  }\n};\nexport type Fallback = (data: DynamicData) => DynamicData;\nlet currentFallback: Fallback = data => data;\nexport function defineFallback(fallback: Fallback): void {\n  currentFallback = fallback;\n}\n\nconst insertAttributeMarker = (\n  marker: string,\n  si: number,\n  appendedStatic: string\n): string => {\n  while (si++) {\n    const char = appendedStatic.charAt(si);\n    if (!char) {\n      break;\n    }\n    if (char === ' ') {\n      return (\n        appendedStatic.slice(0, si) + ' ' + marker + appendedStatic.slice(si)\n      );\n    }\n  }\n  return appendedStatic;\n};\n\nfunction createTemplate(htmlResult: HTMLResult): HTMLTemplateElement {\n  let appendedStatic: string = '';\n  const { dynamicData, staticParts } = htmlResult;\n  for (let i = 0; i < dynamicData.length; i++) {\n    let data = applyFallback(dynamicData[i], currentFallback);\n    const staticPart = staticParts[i];\n    appendedStatic += staticPart;\n    if (data.staticValue) {\n      appendedStatic += data.staticValue;\n    } else {\n      switch (data.type) {\n        case DirectiveType.TEXT:\n          appendedStatic += data.marker;\n          break;\n        case DirectiveType.ATTRIBUTE_VALUE:\n        case DirectiveType.ATTRIBUTE:\n          appendedStatic = insertAttributeMarker(\n            data.marker,\n            appendedStatic.length + 1 - data.dx,\n            appendedStatic\n          );\n          break;\n      }\n    }\n  }\n  appendedStatic += staticParts[staticParts.length - 1];\n  const template = document.createElement('template');\n  template.innerHTML = appendedStatic.trim();\n  return template;\n}\nexport type DirectiveFallback = (data: DynamicData) => DynamicData;\nexport interface DirectiveFallbacks {\n  [DirectiveType.ATTRIBUTE]: DirectiveFallback;\n}\nconst generatorMap: WeakMap<Node, DirectiveGenerator[]> = new WeakMap();\nfunction processTemplate(\n  template: HTMLTemplateElement,\n  container: Node,\n  htmlResult: HTMLResult\n): void {\n  const generators: DirectiveGenerator[] = [];\n  generatorMap.set(container, generators);\n  const fragment = template.content;\n  htmlResult.template = template.cloneNode(true) as HTMLTemplateElement;\n  const { dynamicData } = htmlResult;\n\n  dynamicData.forEach((data, id) => {\n    if (data.directive) {\n      switch (data.type) {\n        case DirectiveType.TEXT:\n          const textMarker = getTextMarker(id);\n          const placeholder = fragment.querySelector(textMarker);\n          let textNode;\n          let isTextArea = false;\n          if (placeholder) {\n            textNode = placeholder.firstChild;\n          } else {\n            isTextArea = true;\n            const textareas = fragment.querySelectorAll('textarea');\n            for (let i = 0; i < textareas.length; i++) {\n              const area = textareas[i];\n              if (area.innerText.includes(textMarker)) {\n                textNode = area.firstChild;\n                break;\n              }\n            }\n          }\n\n          generators[id] = data.directive.factory.call(\n            {\n              type: data.type,\n              container,\n            },\n            textNode,\n            ...data.directive.args\n          );\n          if (!isTextArea) {\n            placeholder.parentNode.replaceChild(textNode, placeholder);\n          }\n          break;\n        case DirectiveType.ATTRIBUTE:\n        case DirectiveType.ATTRIBUTE_VALUE:\n          const marker = getAttributeMarker(id);\n          const node = fragment.querySelector(`[${marker}]`);\n          generators[id] = data.directive.factory.call(\n            {\n              type: data.type,\n              container,\n            },\n            node,\n            ...data.directive.args\n          );\n          node.removeAttribute(marker);\n      }\n    }\n  });\n  renderedNodesMap.set(container, Array.from(fragment.childNodes));\n}\n\nfunction applyFallback(data: DynamicData, fallback: Fallback): DynamicData {\n  if (!data.directive) {\n    Object.assign(data, fallback(data));\n    if (data.directive) {\n      data.staticValue = undefined;\n    }\n  }\n  return data;\n}\n\ninterface CachedData {\n  staticParts?: TemplateStringsArray;\n  states?: any[];\n  prevValues?: any[][];\n}\nconst containerDataCache: WeakMap<Node, CachedData> = new WeakMap();\nexport const render = (\n  container: Node,\n  htmlResult: HTMLResult\n): Promise<void> => {\n  let fragment: DocumentFragment;\n  let init = false;\n  const dataCache: CachedData = containerDataCache.get(container) || {};\n  containerDataCache.set(container, dataCache);\n  if (!renderedNodesMap.has(container)) {\n    init = true;\n    const template = createTemplate(htmlResult);\n    processTemplate(template, container, htmlResult);\n    fragment = template.content;\n  }\n  const generators: DirectiveGenerator[] = generatorMap.get(container);\n\n  if (dataCache.staticParts !== htmlResult.staticParts) {\n    dataCache.staticParts = htmlResult.staticParts;\n    dataCache.states = [];\n    dataCache.prevValues = [];\n  }\n  const promise = Promise.all(\n    htmlResult.dynamicData.map(async (data, id) => {\n      if (!dataCache.prevValues[id]) {\n        dataCache.prevValues[id] = [];\n      }\n      data = applyFallback(data, currentFallback);\n      if (data.directive) {\n        if (\n          dataCache.prevValues[id].length !== data.directive.args.length ||\n          dataCache.prevValues[id].findIndex(\n            (arg, index) =>\n              data.directive.args[index] !== arg ||\n              data.directive.args[index] instanceof Object\n          ) > -1\n        ) {\n          if (dataCache.states[id] === undefined) {\n            dataCache.states[id] = {};\n          }\n          const result = await generators[id].next(data.directive.args);\n          const domUpdates = await result.value;\n          dataCache.prevValues[id].length = 0;\n          dataCache.prevValues[id].push(...data.directive.args);\n          if (domUpdates && domUpdates.length > 0) {\n            return schedule(\n              () => {\n                domUpdates.forEach(d => {\n                  switch (d.type) {\n                    case DOMUpdateType.TEXT:\n                      d.node.textContent = d.value;\n                      break;\n                    case DOMUpdateType.ADD_NODE:\n                      d.node.appendChild(d.newNode);\n                      break;\n                    case DOMUpdateType.PREPEND_NODE:\n                      if (d.node.firstChild) {\n                        d.node.insertBefore(d.newNode, d.node.firstChild);\n                      } else {\n                        d.node.appendChild(d.newNode);\n                      }\n                      break;\n                    case DOMUpdateType.REPLACE_NODE:\n                      d.node.parentNode.replaceChild(d.newNode, d.node);\n                      break;\n                    case DOMUpdateType.INSERT_BEFORE:\n                      d.node.parentNode.insertBefore(d.newNode, d.node);\n                      break;\n                    case DOMUpdateType.INSERT_AFTER:\n                      if (d.node.nextSibling) {\n                        d.node.parentNode.insertBefore(\n                          d.newNode,\n                          d.node.nextSibling\n                        );\n                      } else {\n                        d.node.parentNode.appendChild(d.newNode);\n                      }\n                      break;\n                    case DOMUpdateType.REMOVE:\n                      d.node.parentNode.removeChild(d.node);\n                      break;\n                    case DOMUpdateType.ADD_CLASS:\n                      (d.node as HTMLElement).classList.add(d.value);\n                      break;\n                    case DOMUpdateType.REMOVE_CLASS:\n                      (d.node as HTMLElement).classList.remove(d.value);\n                      break;\n                    case DOMUpdateType.SET_ATTRIBUTE:\n                      (d.node as HTMLElement).setAttribute(d.name, d.value);\n                      break;\n                  }\n                });\n              },\n              init ? PriorityLevel.IMMEDIATE : undefined\n            );\n          }\n        }\n      }\n    })\n  ).then(() => {});\n  if (fragment) {\n    container.appendChild(fragment);\n  }\n  return promise;\n};\n","import { HTMLResult } from './html';\nimport { State, $state, proxify } from '../reactivity/reactivity';\nimport { render } from './render';\nimport { schedule, PriorityLevel } from '../scheduler/scheduler';\n\nexport type ComponentGenerator = Generator<() => HTMLResult>;\nexport type ComponentGeneratorFactory<StateType extends {}> = (\n  state: State<StateType>\n) => ComponentGenerator;\n\nexport type ConnectedListener = () => void | (() => void);\n\nconst COMPONENT_CONTEXT = Symbol.for('component_context');\ninterface SideEffect {\n  cb: ConnectedListener;\n  cleanUp?: () => void;\n  deps: () => any[];\n  prevDeps?: any[];\n  canRun?: boolean;\n}\ninterface ComponentContext {\n  connectedListeners: ConnectedListener[];\n  sideEffects: SideEffect[];\n  host: HTMLElement;\n}\nfunction getContext(): ComponentContext {\n  if (window[COMPONENT_CONTEXT]) {\n    return window[COMPONENT_CONTEXT];\n  }\n  return undefined;\n}\nexport function getHost<E extends HTMLElement>(): E {\n  const context = getContext();\n  if (context) {\n    return context.host as E;\n  }\n  throw 'getHost can only be called in the setup phase!';\n}\nexport function sideEffect(cb: ConnectedListener, deps?: () => any[]): void {\n  const context = getContext();\n  if (context) {\n    context.sideEffects.push({ cb, deps });\n  }\n}\nexport function connected(cb: ConnectedListener): void {\n  const context = getContext();\n  if (context) {\n    context.connectedListeners.push(cb);\n  }\n}\ndeclare global {\n  interface Window {\n    [COMPONENT_CONTEXT]: ComponentContext;\n  }\n}\n\nconst observerMap: WeakMap<HTMLElement, MutationObserver> = new WeakMap();\n\nconst addObserver = (\n  element: HTMLElement,\n  onChange: (name: string, value: string) => void\n): void => {\n  if (!observerMap.has(element)) {\n    const observer = new MutationObserver((mutationsList: MutationRecord[]) => {\n      for (const mutation of mutationsList) {\n        if (mutation.type === 'attributes') {\n          onChange(\n            mutation.attributeName,\n            element.getAttribute(mutation.attributeName)\n          );\n        }\n      }\n    });\n    observerMap.set(element, observer);\n  }\n};\n\nconst startObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).observe(element, { attributes: true });\n  }\n};\n\nconst stopObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).disconnect();\n  }\n};\n\nfunction createPropertyProxy(element: any, queueRender: () => void) {\n  const accessedProps: string[] = [];\n  const $properties = proxify({}, () => {}, {\n    set: (obj, prop: any, value) => {\n      if (obj[prop] !== value && accessedProps.includes(prop)) {\n        queueRender();\n      }\n      return value;\n    },\n    get: (obj, prop: any) => {\n      if (!obj[prop]) {\n        obj[prop] = element[prop] || undefined;\n      }\n      if (!accessedProps.includes(prop)) {\n        accessedProps.push(prop);\n        Object.defineProperty(element, prop, {\n          get: () => obj[prop],\n          set: (value: any) => {\n            if (obj[prop] !== value) {\n              obj[prop] = value;\n              queueRender();\n            }\n          },\n        });\n      }\n    },\n  });\n  return $properties;\n}\n\nfunction createAttributeProxy(element: HTMLElement, queueRender: () => void) {\n  const accessedAttributes: string[] = [];\n  const $attributes = proxify({}, () => {}, {\n    set: (obj, prop, value) => {\n      if (obj[prop] !== value) {\n        schedule(() => {\n          element.setAttribute(prop as string, value);\n        });\n        queueRender();\n      }\n      return value;\n    },\n    get: (obj, prop: any) => {\n      if (!obj[prop]) {\n        obj[prop] = element.getAttribute(prop) || undefined;\n      }\n      if (!accessedAttributes.includes(prop)) {\n        accessedAttributes.push(prop);\n      }\n      return obj[prop];\n    },\n  });\n  addObserver(element, (name, value) => {\n    if (accessedAttributes.includes(name)) {\n      $attributes[name] = value;\n    }\n  });\n  return $attributes;\n}\n\nexport function component<\n  StateValueType extends {} = { [key: string]: any },\n  StateType extends StateValueType & {\n    attributes: { [key: string]: string };\n    properties: { [key: string]: any };\n  } = StateValueType & {\n    attributes: { [key: string]: string };\n    properties: { [key: string]: any };\n  },\n  S extends State<StateType> = State<StateType>\n>(name: string, factory: ComponentGeneratorFactory<StateType>): void {\n  customElements.define(\n    name,\n    class extends HTMLElement {\n      private disconnectedListeners: (() => void)[] = [];\n      private generator: ComponentGenerator;\n      private context: ComponentContext = {\n        connectedListeners: [],\n        sideEffects: [],\n        host: this,\n      };\n      private $s: S;\n      private stopRenderLoop: () => void;\n      private connected: boolean = false;\n      private renderPromise: Promise<void>;\n\n      constructor() {\n        super();\n        window[COMPONENT_CONTEXT] = this.context;\n        this.attachShadow({ mode: 'open' });\n        this.$s = $state<S>({\n          attributes: createAttributeProxy(this, () => this.queueRender()),\n          properties: createPropertyProxy(this, () => this.queueRender()),\n        } as Partial<S>);\n        this.generator = factory(this.$s);\n      }\n\n      private canRunSideEffect(sideEffect: SideEffect): boolean {\n        sideEffect.canRun =\n          sideEffect.canRun || !sideEffect.deps || !sideEffect.prevDeps;\n        if (!sideEffect.canRun) {\n          const deps = sideEffect.deps();\n          if (sideEffect.prevDeps) {\n            if (\n              deps.findIndex((dep, key) => sideEffect.prevDeps[key] !== dep) >\n              -1\n            ) {\n              sideEffect.canRun = true;\n            }\n          } else {\n            sideEffect.canRun = true;\n          }\n          sideEffect.prevDeps = deps;\n        } else {\n          if (sideEffect.deps) {\n            sideEffect.prevDeps = sideEffect.deps();\n          }\n        }\n        return sideEffect.canRun;\n      }\n\n      private async runSideEffects(): Promise<void> {\n        const promises: Promise<void>[] = [];\n        for (const sideEffect of this.context.sideEffects) {\n          if (this.canRunSideEffect(sideEffect)) {\n            sideEffect.canRun = undefined;\n            promises.push(\n              new Promise(async resolve => {\n                await schedule(() => {\n                  sideEffect.cleanUp = sideEffect.cb() as () => void;\n                }, PriorityLevel.LOW);\n                resolve();\n              })\n            );\n          }\n        }\n        await Promise.all(promises);\n      }\n\n      private async runCleanUps(force: boolean = false): Promise<void> {\n        const promises: Promise<void>[] = [];\n        for (const sideEffect of this.context.sideEffects) {\n          if (this.canRunSideEffect(sideEffect) || force) {\n            if (sideEffect.cleanUp) {\n              promises.push(\n                new Promise(async resolve => {\n                  await schedule(() => {\n                    sideEffect.cleanUp();\n                    sideEffect.cleanUp = undefined;\n                  }, PriorityLevel.LOW);\n                  resolve();\n                })\n              );\n            }\n          }\n        }\n        await Promise.all(promises);\n      }\n\n      private nextQueued = false;\n      private async queueRender(): Promise<void> {\n        if (!this.renderPromise) {\n          const value = this.generator.next().value;\n          window[COMPONENT_CONTEXT] = undefined;\n          if (value) {\n            this.renderPromise = new Promise(async resolve => {\n              await this.runCleanUps();\n              await render(this.shadowRoot, value());\n              await this.runSideEffects();\n              this.renderPromise = undefined;\n              if (this.nextQueued) {\n                this.nextQueued = false;\n                this.queueRender();\n              }\n              resolve();\n            });\n          }\n        } else {\n          this.nextQueued = true;\n        }\n      }\n\n      public connectedCallback(): void {\n        if (!this.connected) {\n          this.queueRender();\n          this.stopRenderLoop = this.$s.on(() => {\n            this.queueRender();\n          });\n          startObserving(this);\n        }\n        this.disconnectedListeners = this.context.connectedListeners\n          .map(cb => cb())\n          .filter(l => l) as (() => void)[];\n      }\n\n      public async disconnectedCallback(): Promise<void> {\n        if (this.connected) {\n          stopObserving(this);\n          if (this.stopRenderLoop) {\n            this.stopRenderLoop();\n          }\n          this.connected = false;\n          this.disconnectedListeners.forEach(cb => cb());\n          this.disconnectedListeners = [];\n          await this.renderPromise;\n          this.runCleanUps(true);\n          this.context.sideEffects.forEach(sideEffect => {\n            sideEffect.prevDeps = undefined;\n          });\n        }\n      }\n    }\n  );\n}\n","import { getHost } from './component';\n\nexport function createEvent(\n  name: string,\n  customEventInit: Omit<CustomEventInit, 'detail'> = {\n    bubbles: true,\n    composed: true,\n  }\n) {\n  const host = getHost();\n  return (value?: any) =>\n    host.dispatchEvent(\n      new CustomEvent(name, {\n        ...customEventInit,\n        detail: value,\n      })\n    );\n}\n","import { createDirective, DOMUpdateType } from '../directive';\nimport { DirectiveType } from '../html';\n\nexport const text = createDirective(function*(node: Text, value: string) {\n  if (this.type === DirectiveType.TEXT) {\n    for (;;) {\n      const result = yield [\n        {\n          node,\n          value,\n          type: DOMUpdateType.TEXT,\n        },\n      ];\n      value = result[0];\n    }\n  }\n});\n","import { createDirective, DOMUpdate, DOMUpdateType } from '../directive';\n\nexport const clss = createDirective(function*(node: Node, classes: string) {\n  if (node instanceof HTMLElement) {\n    let oldClasses: string[] = [];\n    for (;;) {\n      const result: DOMUpdate[] = [];\n      oldClasses.forEach(oldCls => {\n        if (!!oldCls) {\n          result.push({\n            type: DOMUpdateType.REMOVE_CLASS,\n            node,\n            value: oldCls,\n          });\n        }\n      });\n      oldClasses = classes.trim().split(' ');\n      oldClasses.forEach(cls => {\n        if (!!cls) {\n          result.push({\n            type: DOMUpdateType.ADD_CLASS,\n            node,\n            value: cls,\n          });\n        }\n      });\n      classes = (yield result)[0];\n    }\n  }\n});\n","import { createDirective, DOMUpdate, DOMUpdateType } from '../directive';\nimport { DirectiveType } from '../html';\n\nexport const attr = createDirective(function*(\n  node: Node,\n  name: string,\n  value: string\n) {\n  if (\n    node instanceof HTMLElement &&\n    (this.type === DirectiveType.ATTRIBUTE ||\n      this.type === DirectiveType.ATTRIBUTE_VALUE)\n  ) {\n    for (;;) {\n      const result: DOMUpdate[] = [\n        {\n          type: DOMUpdateType.SET_ATTRIBUTE,\n          node,\n          value,\n          name,\n        },\n      ];\n      const newArgs = yield result;\n      name = newArgs[0];\n      value = newArgs[1];\n    }\n  }\n});\n","import { createDirective } from '../directive';\nimport { schedule, PriorityLevel } from '../../scheduler/scheduler';\n\nexport const on = createDirective(function*(\n  node: HTMLElement,\n  name: string,\n  cb: <E extends Event>(e: E) => void\n) {\n  node.removeAttribute(name);\n  if (name.startsWith('on')) {\n    name = name.replace('on', '');\n  }\n  const cbRef = {\n    cb,\n  };\n  node.addEventListener(name, e => {\n    schedule(() => cbRef.cb(e), PriorityLevel.IMMEDIATE);\n  });\n  for (;;) {\n    cbRef.cb = (yield)[1];\n  }\n});\n","import { createDirective } from '../directive';\n\nexport const prop = createDirective(function*(\n  node: Node,\n  name: string,\n  value: any\n) {\n  if (node instanceof HTMLElement) {\n    node.removeAttribute(name);\n    for (;;) {\n      if (name.startsWith('.')) {\n        name = name.replace('.', '');\n      }\n      (node as any)[name] = value;\n      const newArgs = yield;\n      name = newArgs[0];\n      value = newArgs[1];\n    }\n  }\n});\n","import { createDirective } from '../directive';\nimport { PriorityLevel, schedule } from '../../scheduler/scheduler';\n\nexport const input = createDirective(function*(\n  node: HTMLElement,\n  cb: (value: string) => void\n) {\n  const cbRef = {\n    cb,\n  };\n  node.addEventListener('input', e => {\n    const value: string = (e.target as HTMLInputElement).value;\n    schedule(() => cbRef.cb(value), PriorityLevel.NORMAL);\n  });\n  for (;;) {\n    cbRef.cb = (yield)[0];\n  }\n});\n","import { createDirective, DOMUpdateType, DOMUpdate } from '../directive';\nimport { HTMLResult, DirectiveType } from '../html';\nimport { render } from '../render';\n\nexport const sub = createDirective(async function*(\n  node: Text,\n  htmlResult: HTMLResult\n) {\n  if (this.type === DirectiveType.TEXT) {\n    const start = document.createComment('');\n    let result: DOMUpdate[] = [\n      {\n        type: DOMUpdateType.REPLACE_NODE,\n        node,\n        newNode: start as any,\n      },\n    ];\n    let prevParts: TemplateStringsArray;\n    let prevFrag: DocumentFragment;\n    let prevChildren: Node[] = [];\n    for (;;) {\n      if (prevParts === htmlResult.staticParts) {\n        await render(prevFrag as any, htmlResult);\n      } else {\n        const frag = document.createDocumentFragment();\n        await render(frag as any, htmlResult);\n        prevChildren.forEach(child => {\n          result.push({\n            type: DOMUpdateType.REMOVE,\n            node: child,\n          });\n        });\n        prevChildren = [];\n        frag.childNodes.forEach(child => {\n          prevChildren.push(child);\n          result.push({\n            type: DOMUpdateType.INSERT_BEFORE,\n            node: start,\n            newNode: child,\n          });\n        });\n        prevParts = htmlResult.staticParts;\n        prevFrag = frag;\n      }\n      htmlResult = (yield result)[0];\n      result = [];\n    }\n  }\n});\n","import { createDirective, DOMUpdateType, DOMUpdate } from '../directive';\n\nexport const frag = createDirective(function*(node: Text, html: string) {\n  if (node.nodeType === 3) {\n    const start = document.createComment('');\n    let result: DOMUpdate[] = [\n      {\n        type: DOMUpdateType.REPLACE_NODE,\n        node,\n        newNode: start as any,\n      },\n    ];\n    const template = document.createElement('template');\n    let prevChildren: Node[] = [];\n    for (;;) {\n      template.innerHTML = html;\n      const frag = template.content;\n      prevChildren.forEach(child => {\n        result.push({\n          type: DOMUpdateType.REMOVE,\n          node: child,\n        });\n      });\n      prevChildren = [];\n      frag.childNodes.forEach(child => {\n        prevChildren.push(child);\n        result.push({\n          type: DOMUpdateType.INSERT_BEFORE,\n          node: start,\n          newNode: child,\n        });\n      });\n      html = (yield result)[0];\n      result = [];\n    }\n  }\n});\n","import { createDirective, DOMUpdateType, DOMUpdate } from '../directive';\nimport { HTMLResult } from '../html';\nimport { render } from '../render';\n\nexport function getKey(htmlResult: HTMLResult): string {\n  for (const dynamicData of htmlResult.dynamicData) {\n    if (dynamicData.attribute === 'key') {\n      dynamicData.directive = key(dynamicData.staticValue);\n      delete dynamicData.staticValue;\n    }\n    if (dynamicData.directive) {\n      if ((dynamicData.directive.directive as any) === key) {\n        return dynamicData.directive.args[0];\n      }\n    }\n  }\n  return htmlResult.staticParts.join();\n}\n\nexport const list = createDirective(function*(\n  node: Text,\n  htmlResults: HTMLResult[]\n) {\n  if (node.nodeType === 3) {\n    const root = document.createDocumentFragment();\n    const end = document.createComment('');\n    const start = document.createComment('');\n    root.appendChild(start);\n    root.appendChild(end);\n    const keyToFragmentsMap: Map<string, [DocumentFragment, Node]> = new Map();\n    let results: DOMUpdate[] = [\n      {\n        type: DOMUpdateType.REPLACE_NODE,\n        node,\n        newNode: root,\n      },\n    ];\n    let oldKeyOrder: string[] = [];\n    for (;;) {\n      const keyOrder: string[] = htmlResults.map(result => {\n        const key = getKey(result);\n        if (!keyToFragmentsMap.has(key)) {\n          const frag = document.createDocumentFragment();\n          render(frag as any, result);\n          if (frag.childNodes.length > 1) {\n            throw 'List items should only render a single node!';\n          }\n          keyToFragmentsMap.set(key, [frag, frag.childNodes[0]]);\n        } else {\n          const frag = keyToFragmentsMap.get(key)[0] as DocumentFragment;\n          render(frag as any, result);\n        }\n        return key;\n      });\n\n      function tryInsert(\n        key: string,\n        oldIndex: number,\n        newIndex: number\n      ): void {\n        const next = keyOrder[newIndex + 1];\n        const nextIndex = keyOrder.indexOf(next);\n        if (nextIndex === -1) {\n          if (\n            oldIndex < Math.max(0, oldKeyOrder.length - 1) ||\n            newIndex === -1\n          ) {\n            results.push({\n              type: DOMUpdateType.INSERT_BEFORE,\n              node: end,\n              newNode: keyToFragmentsMap.get(key)[1],\n            });\n            if (oldIndex > -1) {\n              oldKeyOrder.splice(oldIndex, 1);\n            }\n            oldKeyOrder.push(key);\n          }\n        } else if (oldKeyOrder.indexOf(next) === nextIndex) {\n          results.push({\n            type: DOMUpdateType.INSERT_BEFORE,\n            node: keyToFragmentsMap.get(next)[1],\n            newNode: keyToFragmentsMap.get(key)[1],\n          });\n          if (oldIndex > -1) {\n            oldKeyOrder.splice(oldIndex, 1);\n          }\n          oldKeyOrder.splice(oldKeyOrder.indexOf(next), 0, key);\n        } else {\n          const previous = keyOrder[newIndex - 1];\n          const previousIndex = keyOrder.indexOf(previous);\n          if (previousIndex === -1) {\n            results.push({\n              type: DOMUpdateType.INSERT_AFTER,\n              node: start,\n              newNode: keyToFragmentsMap.get(key)[1],\n            });\n            if (oldIndex > -1) {\n              oldKeyOrder.splice(oldIndex, 1);\n            }\n            oldKeyOrder.unshift(key);\n          } else if (oldKeyOrder.indexOf(previous) === previousIndex) {\n            results.push({\n              type: DOMUpdateType.INSERT_AFTER,\n              node: keyToFragmentsMap.get(previous)[1],\n              newNode: keyToFragmentsMap.get(key)[1],\n            });\n            if (oldIndex > -1) {\n              oldKeyOrder.splice(oldIndex, 1);\n            }\n            oldKeyOrder.splice(oldKeyOrder.indexOf(next) + 1, 0, key);\n          }\n        }\n      }\n\n      function handleKey(key: string): void {\n        const oldIndex = oldKeyOrder.indexOf(key);\n        const newIndex = keyOrder.indexOf(key);\n        if (oldIndex !== newIndex) {\n          if (oldIndex > -1 && newIndex === -1) {\n            results.push({\n              type: DOMUpdateType.REMOVE,\n              node: keyToFragmentsMap.get(key)[1],\n            });\n            oldKeyOrder.splice(oldIndex, 1);\n          } else {\n            tryInsert(key, oldIndex, newIndex);\n          }\n        }\n      }\n      let j = 0;\n      while (keyOrder.join() !== oldKeyOrder.join()) {\n        j++;\n        if (j > keyOrder.length) {\n          console.log('break');\n          break;\n        }\n        const oldKeyOrderCopy = [...oldKeyOrder];\n        const keyOrderCopy = [...keyOrder];\n        for (\n          let i = 0;\n          i < Math.max(oldKeyOrder.length, keyOrder.length);\n          i++\n        ) {\n          let key = oldKeyOrderCopy[i];\n          if (key && keyOrder.indexOf(key) !== i) {\n            handleKey(key);\n          }\n          key = keyOrderCopy[i];\n          if (key && oldKeyOrder.indexOf(key) !== i) {\n            handleKey(key);\n          }\n        }\n      }\n      htmlResults = (yield results)[0];\n      results = [];\n    }\n  }\n});\n\nexport const key = createDirective(function*(\n  node: HTMLElement,\n  _keyName: string\n) {\n  node.removeAttribute('key');\n});\n","import { defineFallback } from './render';\nimport { DirectiveType, IS_HTML_RESULT } from './html';\nimport { attr } from './directives/attr';\nimport { text } from './directives/text';\nimport { sub } from './directives/sub';\nimport { on } from './directives/on';\nimport { prop } from './directives/prop';\nimport { list, key } from './directives/list';\n\nexport function applyDefaultFallback(): void {\n  defineFallback(data => {\n    if (data.type === DirectiveType.TEXT) {\n      if (\n        typeof data.staticValue === 'string' ||\n        typeof data.staticValue === 'number'\n      ) {\n        data.directive = text(data.staticValue + '') as any;\n      } else if (\n        data.staticValue instanceof Array &&\n        data.staticValue.findIndex(\n          item => !(typeof item === 'object' && item[IS_HTML_RESULT])\n        ) === -1\n      ) {\n        data.directive = list(data.staticValue);\n      }\n    }\n    if (data.type === DirectiveType.ATTRIBUTE_VALUE) {\n      if (data.attribute.startsWith('on')) {\n        data.directive = on(data.attribute, data.staticValue) as any;\n      } else if (data.attribute.startsWith('.')) {\n        data.directive = prop(data.attribute, data.staticValue) as any;\n      } else if (data.attribute === 'key') {\n        data.directive = key(data.staticValue) as any;\n      } else {\n        data.directive = attr(data.attribute, data.staticValue + '') as any;\n      }\n    }\n\n    if (\n      data.type === DirectiveType.TEXT &&\n      typeof data.staticValue === 'object' &&\n      data.staticValue.dynamicData\n    ) {\n      data.directive = sub(data.staticValue) as any;\n    }\n    return data;\n  });\n}\n"],"names":["isProxyMap","WeakSet","proxify","obj","onChange","hooks","initialized","onChangeWrapped","Object","keys","forEach","key","has","proxy","Proxy","get","prop","set","value","console","log","add","$state","initialState","listeners","canEmit","l","on","listener","push","index","indexOf","splice","merge","otherState","performMerge","includes","DOMUpdateType","IS_DIRECTIVE","Symbol","createDirective","factory","directive","args","isLetter","c","toLowerCase","toUpperCase","DirectiveType","getTextMarker","id","getAttributeMarker","IS_HTML_RESULT","isDirective","thing","resultCache","WeakMap","html","staticParts","dynamicParts","result","appendedStatic","dynamicData","i","length","dynamicPart","staticPart","dx","currentDynamicData","staticValue","si","attributeValueMode","attributeMode","attributeNameFound","attributeName","char","charAt","nextChar","nextNextChar","marker","type","TEXT","ATTRIBUTE_VALUE","attribute","ATTRIBUTE","map","data","undefined","PriorityLevel","scheduledJobs","schedulerRunning","MAX_ELAPSED","processJobQueue","queue","now","totalElapsed","Date","cb","latestEndTime","slice","processScheduledJobs","sort","a","b","requestAnimationFrame","schedule","priority","NORMAL","IMMEDIATE","Promise","resolve","renderedNodesMap","currentFallback","defineFallback","fallback","insertAttributeMarker","createTemplate","htmlResult","applyFallback","template","document","createElement","innerHTML","trim","generatorMap","processTemplate","container","generators","fragment","content","cloneNode","textMarker","placeholder","querySelector","textNode","isTextArea","firstChild","textareas","querySelectorAll","area","innerText","call","parentNode","replaceChild","node","removeAttribute","Array","from","childNodes","assign","containerDataCache","render","init","dataCache","states","prevValues","promise","all","findIndex","arg","next","domUpdates","d","textContent","ADD_NODE","appendChild","newNode","PREPEND_NODE","insertBefore","REPLACE_NODE","INSERT_BEFORE","INSERT_AFTER","nextSibling","REMOVE","removeChild","ADD_CLASS","classList","REMOVE_CLASS","remove","SET_ATTRIBUTE","setAttribute","name","then","COMPONENT_CONTEXT","getContext","window","getHost","context","host","sideEffect","deps","sideEffects","connected","connectedListeners","observerMap","addObserver","element","observer","MutationObserver","mutationsList","mutation","getAttribute","startObserving","observe","attributes","stopObserving","disconnect","createPropertyProxy","queueRender","accessedProps","$properties","defineProperty","createAttributeProxy","accessedAttributes","$attributes","component","customElements","define","attachShadow","mode","$s","properties","generator","canRunSideEffect","canRun","prevDeps","dep","runSideEffects","promises","cleanUp","LOW","runCleanUps","force","renderPromise","shadowRoot","nextQueued","connectedCallback","stopRenderLoop","disconnectedListeners","filter","disconnectedCallback","HTMLElement","createEvent","customEventInit","bubbles","composed","dispatchEvent","CustomEvent","detail","text","clss","classes","oldClasses","oldCls","split","cls","attr","newArgs","startsWith","replace","cbRef","addEventListener","e","input","target","sub","start","createComment","prevChildren","prevParts","prevFrag","frag","createDocumentFragment","child","nodeType","getKey","join","list","htmlResults","root","end","keyToFragmentsMap","Map","results","oldKeyOrder","tryInsert","handleKey","oldIndex","newIndex","keyOrder","nextIndex","Math","max","previous","previousIndex","unshift","j","oldKeyOrderCopy","keyOrderCopy","_keyName","applyDefaultFallback","item"],"mappings":"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"}