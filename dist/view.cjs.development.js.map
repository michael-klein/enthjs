{"version":3,"file":"view.cjs.development.js","sources":["../src/html.ts","../src/render.ts","../src/scheduler.ts","../src/directive.ts","../src/directives/sub.ts","../src/reactivity.ts","../src/misc.ts","../src/context.ts","../src/sideeffects.ts","../src/component.ts","../src/properties.ts","../src/attributes.ts","../src/directives/text.ts","../src/directives/on.ts","../src/directives/input.ts"],"sourcesContent":["const isLetter = (c: string): boolean => {\n  return c.toLowerCase() != c.toUpperCase();\n};\n\nexport enum DirectiveType {\n  TEXT,\n  ATTRIBUTE,\n  ATTRIBUTE_VALUE,\n}\nexport interface DirectiveData {\n  d: Function;\n  t?: DirectiveType;\n  a?: string;\n  n?: Node;\n  c?: () => void;\n}\nconst insertAttributeMarker = (\n  marker: string,\n  si: number,\n  appendedStatic: string\n): string => {\n  while (si++) {\n    const char = appendedStatic.charAt(si);\n    if (!char) {\n      break;\n    }\n    if (char === ' ') {\n      return (\n        appendedStatic.slice(0, si) + ' ' + marker + appendedStatic.slice(si)\n      );\n    }\n  }\n  return appendedStatic;\n};\nexport const getTextMarker = (id: number): string => {\n  return `tm-${id}`;\n};\nexport const getAttributeMarker = (id: number): string => {\n  return `data-am-${id}`;\n};\nexport interface HTMLResult {\n  template: HTMLTemplateElement;\n  directives: DirectiveData[];\n}\nlet resultCache: WeakMap<TemplateStringsArray, HTMLResult> = new WeakMap();\nexport const html = (\n  staticParts: TemplateStringsArray,\n  ...dynamicParts: any[]\n): HTMLResult => {\n  let result: HTMLResult = resultCache.get(staticParts);\n  if (!result) {\n    let appendedStatic: string = '';\n    const directives: DirectiveData[] = [];\n    for (let i = 0; i < dynamicParts.length; i++) {\n      const dynamicPart = dynamicParts[i];\n      const staticPart = staticParts[i];\n      appendedStatic += staticPart;\n      if (typeof dynamicPart !== 'function') {\n        appendedStatic += dynamicPart;\n        continue;\n      }\n      let id =\n        directives.push({\n          d: dynamicPart,\n        }) - 1;\n      let si = appendedStatic.length + 1;\n      let attributeValueMode = false;\n      let attributeMode = false;\n      let attributeNameFound = false;\n      let attributeName = '';\n      while (si--) {\n        const char = appendedStatic.charAt(si);\n        const nextChar = appendedStatic.charAt(si - 1);\n        const nextNextChar = appendedStatic.charAt(si - 2);\n        if (char === '>' || si === 0) {\n          let marker = getTextMarker(id);\n          appendedStatic += `<${marker}>&zwnj;</${marker}>`;\n          directives[id].t = DirectiveType.TEXT;\n          break;\n        }\n        if (\n          char === '\"' &&\n          nextChar === '=' &&\n          isLetter(nextNextChar) &&\n          !attributeMode\n        ) {\n          attributeValueMode = true;\n          continue;\n        }\n        if (char === '\"' && nextNextChar !== '=' && !attributeValueMode) {\n          attributeValueMode = false;\n          attributeMode = true;\n          continue;\n        }\n        if (\n          attributeValueMode &&\n          char !== '\"' &&\n          char !== '=' &&\n          !attributeNameFound\n        ) {\n          if (char !== ' ') {\n            attributeName = char + attributeName;\n          } else {\n            attributeNameFound = true;\n          }\n        }\n        if (char === '<' && attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE_VALUE;\n          directives[id].a = attributeName;\n          if (appendedStatic[appendedStatic.length - 1] === ' ') {\n            appendedStatic = appendedStatic.slice(0, appendedStatic.length - 1);\n          }\n          break;\n        }\n        if (char === '<' && !attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE;\n          break;\n        }\n      }\n    }\n    appendedStatic += staticParts[staticParts.length - 1];\n    const template = document.createElement('template');\n    template.innerHTML = appendedStatic;\n    result = {\n      template,\n      directives,\n    };\n  } else {\n    let directiveIndex: number = 0;\n    dynamicParts.forEach((value: any) => {\n      if (typeof value === 'function') {\n        result.directives[directiveIndex].d = value;\n        directiveIndex++;\n      }\n    });\n  }\n  resultCache.set(staticParts, result);\n  return result;\n};\n","import {\n  HTMLResult,\n  DirectiveType,\n  getTextMarker,\n  getAttributeMarker,\n} from './html';\n\nconst renderedNodesMap: WeakMap<HTMLElement, Node[]> = new WeakMap();\nexport const clear = (container: HTMLElement) => {\n  if (renderedNodesMap.has(container)) {\n    renderedNodesMap\n      .get(container)\n      .forEach(node => container.removeChild(node));\n    renderedNodesMap.delete(container);\n  }\n};\nexport const render = (\n  container: HTMLElement,\n  htmlResult: HTMLResult\n): void => {\n  let fragment: DocumentFragment;\n  if (!renderedNodesMap.has(container)) {\n    fragment = htmlResult.template.content.cloneNode(true) as DocumentFragment;\n    htmlResult.directives.forEach((directiveData, id) => {\n      switch (directiveData.t) {\n        case DirectiveType.TEXT:\n          const placeholder = fragment.querySelector(getTextMarker(id));\n          const textNode = placeholder.firstChild;\n          directiveData.n = textNode;\n          placeholder.parentElement.replaceChild(textNode, placeholder);\n          break;\n        case DirectiveType.ATTRIBUTE:\n        case DirectiveType.ATTRIBUTE_VALUE:\n          const marker = getAttributeMarker(id);\n          const node = fragment.querySelector(`[${marker}]`);\n          node.removeAttribute(marker);\n          directiveData.n = node;\n      }\n    });\n    renderedNodesMap.set(container, Array.from(fragment.childNodes));\n  }\n  htmlResult.directives.forEach(directiveData => {\n    const node = directiveData.d(directiveData.n);\n    if (node) {\n      directiveData.n = node;\n    }\n  });\n  if (fragment) {\n    container.appendChild(fragment);\n  }\n};\n","export enum PriorityLevel {\n  IMMEDIATE = 0, //synchronous\n  USER_BLOCKING = 250, //.25s timeout\n  NORMAL = 5000, // 5s timeout\n  LOW = 10000, // 10s timeout\n  IDLE = 99999999, // no timeout (run only when nothing else is scheduled)\n}\ntype ScheduledJob = [() => void, number];\nlet scheduledJobs: ScheduledJob[] = [];\nlet schedulerRunning: boolean = false;\nconst MAX_ELAPSED: number = 17;\nconst processJobQueue = (\n  queue: ScheduledJob[],\n  now: number\n): ScheduledJob[] => {\n  return queue.filter(([cb, latestEndTime]) => {\n    const totalElapsed: number = Date.now() - now;\n    if (now >= latestEndTime || totalElapsed < MAX_ELAPSED) {\n      cb();\n      return false;\n    } else {\n      return true;\n    }\n  });\n};\nconst processScheduledJobs = () => {\n  const now: number = Date.now();\n  const jobsToRun = scheduledJobs;\n  scheduledJobs = [];\n  const remainingJobs = processJobQueue(\n    jobsToRun.sort((a, b) => (a[1] < b[1] ? -1 : 1)),\n    now\n  );\n  scheduledJobs = remainingJobs.concat(scheduledJobs);\n  if (scheduledJobs.length > 0) {\n    requestAnimationFrame(processScheduledJobs);\n  } else {\n    schedulerRunning = false;\n  }\n};\nexport const schedule = (\n  cb: () => void,\n  priority: PriorityLevel = PriorityLevel.NORMAL\n): Promise<void> => {\n  if (priority === PriorityLevel.IMMEDIATE) {\n    cb();\n  } else {\n    return new Promise(resolve => {\n      scheduledJobs.push([\n        () => {\n          cb();\n          resolve();\n        },\n        Date.now() + priority,\n      ]);\n      if (!schedulerRunning) {\n        requestAnimationFrame(processScheduledJobs);\n        schedulerRunning = true;\n      }\n    });\n  }\n  return Promise.resolve();\n};\nexport type Schedule = typeof schedule;\n","import { schedule, Schedule } from './scheduler';\n\nexport type Directive<N extends Node = Node, Args extends any[] = any[]> = (\n  ...args: Args\n) => (node: N) => void;\nexport type DirectiveHandler<\n  N extends Node = any,\n  Args extends any[] = any[]\n> = (node: N, schedule: Schedule, ...args: Args) => void | Node;\nexport function createDirective<\n  Args extends any[] = any[],\n  N extends Node = any,\n  D extends DirectiveHandler<N, Args> = DirectiveHandler<N, Args>\n>(\n  handler: D\n): D extends (node: N, schedule: Schedule, ...args: infer A) => void\n  ? Directive<N, A>\n  : never {\n  return ((...args: Args) => {\n    return (node: N) => {\n      return handler(node, schedule, ...args);\n    };\n  }) as D extends (node: N, schedule: Schedule, ...args: infer A) => void\n    ? Directive<N, A>\n    : never;\n}\n","import { createDirective } from '../directive';\nimport { Schedule, PriorityLevel } from '../scheduler';\nimport { HTMLResult } from '../html';\nimport { clear, render } from '../render';\n\nexport const sub = createDirective(\n  (node: Node, schedule: Schedule, cb: () => HTMLResult) => {\n    if (node.nodeType === 3) {\n      const span = document.createElement('span');\n      node.parentElement.insertBefore(span, node);\n      node.parentElement.removeChild(node);\n      node = span;\n    }\n    schedule(() => {\n      clear(node as HTMLElement);\n      render(node as HTMLElement, cb());\n    }, PriorityLevel.USER_BLOCKING);\n    return node;\n  }\n);\n","const IS_PROXY = Symbol('$P');\nfunction proxify(obj: any, onChange: () => void): any {\n  const proxy = new Proxy(obj, {\n    get: (obj, prop) => {\n      if (\n        obj[prop] &&\n        typeof obj[prop] === 'object' &&\n        obj[prop].__$p !== IS_PROXY\n      ) {\n        obj[prop] = proxify(obj[prop], onChange);\n      }\n      return obj[prop];\n    },\n    set: (obj, prop, value) => {\n      if (obj[prop] !== value && prop !== '__$p') {\n        obj[prop] = value;\n        onChange();\n      }\n      return true;\n    },\n  });\n  proxy.__$p = IS_PROXY;\n  return proxy;\n}\nlet onStateChanged: () => void;\nexport const setUpState = <CB extends () => any>(\n  cb: CB,\n  onChange: () => void\n): ReturnType<CB> => {\n  onStateChanged = onChange;\n  let result = cb();\n  onStateChanged = undefined;\n  return result;\n};\nexport const $state = <S extends {} = {}>(initialState: Partial<S> = {}): S => {\n  let onChange = onStateChanged;\n  return proxify(initialState, () => onChange && onChange());\n};\n","export const getOnlySetupError = (subject: string): string =>\n  `${subject} can only be used during setup!`;\n","import { getOnlySetupError } from './misc';\n\nconst global: { __$c: HTMLElement } = window as any;\n\nexport const setUpContext = (context: HTMLElement, cb: () => void): void => {\n  global.__$c = context;\n  cb();\n  global.__$c = undefined;\n};\n\nexport const getElement = (): HTMLElement => {\n  if (global.__$c) {\n    return global.__$c;\n  } else {\n    throw getOnlySetupError('getElement');\n  }\n};\n","import { getElement } from './context';\nimport { schedule, PriorityLevel } from './scheduler';\n\nexport type CleanUp = () => void;\nexport type SideEffect = () => void | CleanUp;\ninterface SideEffectsMapItem {\n  e: SideEffect;\n  d?: () => any[];\n  p?: any[];\n  c?: CleanUp;\n}\nconst sideEffectsMap: WeakMap<\n  HTMLElement,\n  SideEffectsMapItem[]\n> = new WeakMap();\n\nexport const sideEffect = (effect: () => void, dependencies?: () => any[]) => {\n  const element = getElement();\n  sideEffectsMap.set(\n    element,\n    (sideEffectsMap.get(element) || []).concat({\n      e: effect,\n      d: dependencies,\n    })\n  );\n};\nconst shouldEffectRun = (effectMapItem: SideEffectsMapItem): boolean => {\n  const { d, p } = effectMapItem;\n  let shouldRun: boolean = true;\n  if (d) {\n    const deps = d();\n    if (\n      p &&\n      (deps === p ||\n        (deps.length === p.length &&\n          deps.findIndex((dep, index) => p[index] !== dep))) === -1\n    ) {\n      shouldRun = false;\n    }\n  }\n  return shouldRun;\n};\nexport const runSideEffects = (element: HTMLElement): Promise<void[]> => {\n  const sideEffects = sideEffectsMap.get(element) || [];\n  if (sideEffects.length > 0) {\n    return Promise.all(\n      sideEffects\n        .map(effectMapItem => {\n          const { c } = effectMapItem;\n          if (c && shouldEffectRun(effectMapItem)) {\n            return schedule(() => {\n              c();\n              effectMapItem.c = undefined;\n            }, PriorityLevel.USER_BLOCKING);\n          }\n          return undefined;\n        })\n        .filter(p => p)\n    ).then(() =>\n      Promise.all(\n        sideEffects\n          .map(effectMapItem => {\n            const { e, d } = effectMapItem;\n            let shouldRun: boolean = shouldEffectRun(effectMapItem);\n            if (d) {\n              effectMapItem.p = d();\n            }\n            if (shouldRun) {\n              return schedule(() => {\n                const cleanUp = e();\n                if (cleanUp) {\n                  effectMapItem.c = cleanUp;\n                }\n              }, PriorityLevel.USER_BLOCKING);\n            }\n            return undefined;\n          })\n          .filter(p => p)\n      )\n    );\n  } else {\n    return Promise.resolve([]);\n  }\n};\n","import { HTMLResult } from './html';\nimport { setUpState } from './reactivity';\nimport { render } from './render';\nimport { schedule, PriorityLevel } from './scheduler';\nimport { setUpContext } from './context';\nimport { runSideEffects } from './sideeffects';\nexport interface ComponentDefinition {\n  render: () => HTMLResult;\n}\nexport type Setup = () => ComponentDefinition;\nexport const component = (name: string, setup: Setup) => {\n  customElements.define(\n    name,\n    class extends HTMLElement {\n      private renderQueued: boolean = false;\n      private nextRenderQueued: boolean = false;\n      private render: () => HTMLResult;\n      constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n\n        setUpContext(this, () =>\n          setUpState(\n            () => (this.render = setup().render),\n            () => {\n              this.performRender();\n            }\n          )\n        );\n        this.performRender();\n      }\n\n      private performRender() {\n        if (!this.renderQueued) {\n          this.renderQueued = true;\n          schedule(() => {\n            render(this.shadowRoot as any, this.render());\n          }, PriorityLevel.USER_BLOCKING)\n            .then(async () => await runSideEffects(this))\n            .then(() => {\n              this.renderQueued = false;\n              if (this.nextRenderQueued) {\n                this.nextRenderQueued = false;\n                this.performRender();\n              }\n            });\n        } else {\n          this.nextRenderQueued = true;\n        }\n      }\n    }\n  );\n};\n","import { getElement } from './context';\nimport { $state } from './reactivity';\n\nexport const $prop = <T>(name: string, initialValue: T): { value: T } => {\n  const element = getElement() as any;\n  const state = $state({ value: initialValue });\n  Object.defineProperty(element, name, {\n    get: () => state.value,\n    set: (value: any) => {\n      state.value = value;\n    },\n  });\n  return state;\n};\n","import { $state } from './reactivity';\nimport { getElement } from './context';\nimport { sideEffect } from './sideeffects';\n\nconst attributeCallbackMap: WeakMap<\n  HTMLElement,\n  { [key: string]: (() => void)[] }\n> = new Map();\nconst observerMap: WeakMap<HTMLElement, MutationObserver> = new WeakMap();\n\nconst addObserver = (element: HTMLElement): void => {\n  if (!observerMap.has(element)) {\n    const observer = new MutationObserver((mutationsList: MutationRecord[]) => {\n      for (const mutation of mutationsList) {\n        if (mutation.type === 'attributes') {\n          const callbacks =\n            (attributeCallbackMap.get(element) || {})[mutation.attributeName] ||\n            [];\n          callbacks.forEach(cb => cb());\n        }\n      }\n    });\n    observerMap.set(element, observer);\n  }\n};\n\nconst startObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).observe(element, { attributes: true });\n  }\n};\n\nconst stopObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).disconnect();\n  }\n};\n\nconst observeAttribute = (\n  element: HTMLElement,\n  name: string,\n  cb: () => void\n): void => {\n  if (!attributeCallbackMap.has(element)) {\n    attributeCallbackMap.set(element, {});\n  }\n  if (!attributeCallbackMap.get(element)[name]) {\n    attributeCallbackMap.get(element)[name] = [];\n  }\n  attributeCallbackMap.get(element)[name].push(cb);\n};\n\nexport const $attr = (\n  name: string,\n  initialValue: string = ''\n): { value: string } => {\n  const element = getElement();\n  addObserver(element);\n  observeAttribute(element, name, () => {\n    const value = element.getAttribute(name);\n    if (state.value !== value) {\n      state.value = element.getAttribute(name);\n    }\n  });\n\n  element.setAttribute(name, initialValue);\n\n  const state = $state({ value: element.getAttribute(name) });\n\n  sideEffect(\n    () => {\n      stopObserving(element);\n      element.setAttribute(name, state.value);\n      startObserving(element);\n    },\n    () => [state.value]\n  );\n\n  return state;\n};\n","import { createDirective } from '../directive';\nimport { Schedule, PriorityLevel } from '../scheduler';\n\nexport const text = createDirective(\n  (node: Text, schedule: Schedule, value: string) => {\n    if (node instanceof Text) {\n      schedule(() => {\n        node.textContent = value;\n      }, PriorityLevel.IMMEDIATE);\n    }\n  }\n);\n","import { createDirective } from '../directive';\nimport { PriorityLevel, Schedule } from '../scheduler';\n\nconst handlerMap: WeakMap<HTMLInputElement, string[]> = new WeakMap();\nexport const onHandler = (\n  node: HTMLInputElement,\n  schedule: Schedule,\n  name: string,\n  cb: <E extends Event>(e: E) => void\n) => {\n  if (!handlerMap.has(node) && !(handlerMap.get(node) || []).includes(name)) {\n    handlerMap.set(\n      node,\n      [].concat(name, handlerMap.get(node)).filter(n => n)\n    );\n    node.addEventListener(name, e => {\n      schedule(() => cb(e), PriorityLevel.IMMEDIATE);\n    });\n  }\n};\nexport const on = createDirective(onHandler);\n","import { createDirective } from '../directive';\nimport { Schedule, PriorityLevel } from '../scheduler';\nimport { onHandler } from './on';\n\nexport const input = createDirective(\n  (node: HTMLInputElement, schedule: Schedule, cb: (value: string) => void) =>\n    onHandler(node, schedule, 'input', e => {\n      const value: string = (e.target as HTMLInputElement).value;\n      schedule(() => cb(value), PriorityLevel.USER_BLOCKING);\n    })\n);\n"],"names":["isLetter","c","toLowerCase","toUpperCase","DirectiveType","insertAttributeMarker","marker","si","appendedStatic","char","charAt","slice","getTextMarker","id","getAttributeMarker","resultCache","WeakMap","html","staticParts","result","get","dynamicParts","directives","i","length","dynamicPart","staticPart","push","d","attributeValueMode","attributeMode","attributeNameFound","attributeName","nextChar","nextNextChar","t","TEXT","ATTRIBUTE_VALUE","a","ATTRIBUTE","template","document","createElement","innerHTML","directiveIndex","forEach","value","set","renderedNodesMap","clear","container","has","node","removeChild","render","htmlResult","fragment","content","cloneNode","directiveData","placeholder","querySelector","textNode","firstChild","n","parentElement","replaceChild","removeAttribute","Array","from","childNodes","appendChild","PriorityLevel","scheduledJobs","schedulerRunning","MAX_ELAPSED","processJobQueue","queue","now","filter","cb","latestEndTime","totalElapsed","Date","processScheduledJobs","jobsToRun","remainingJobs","sort","b","concat","requestAnimationFrame","schedule","priority","NORMAL","IMMEDIATE","Promise","resolve","createDirective","handler","args","sub","nodeType","span","insertBefore","USER_BLOCKING","IS_PROXY","Symbol","proxify","obj","onChange","proxy","Proxy","prop","__$p","onStateChanged","setUpState","undefined","$state","initialState","getOnlySetupError","subject","global","window","setUpContext","context","__$c","getElement","sideEffectsMap","sideEffect","effect","dependencies","element","e","shouldEffectRun","effectMapItem","p","shouldRun","deps","findIndex","dep","index","runSideEffects","sideEffects","all","map","then","cleanUp","component","name","setup","customElements","define","attachShadow","mode","performRender","renderQueued","shadowRoot","nextRenderQueued","HTMLElement","$prop","initialValue","state","Object","defineProperty","attributeCallbackMap","Map","observerMap","addObserver","observer","MutationObserver","mutationsList","mutation","type","callbacks","startObserving","observe","attributes","stopObserving","disconnect","observeAttribute","$attr","getAttribute","setAttribute","text","Text","textContent","handlerMap","onHandler","includes","addEventListener","on","input","target"],"mappings":"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"}