{"version":3,"file":"view.esm.js","sources":["../src/html.ts","../src/render.ts","../src/reactivity.ts","../src/scheduler.ts","../src/misc.ts","../src/context.ts","../src/sideeffects.ts","../src/component.ts","../src/properties.ts","../src/attributes.ts","../src/directive.ts","../src/directives/text.ts","../src/directives/on.ts","../src/directives/input.ts"],"sourcesContent":["const isLetter = (c: string): boolean => {\n  return c.toLowerCase() != c.toUpperCase();\n};\n\nexport enum DirectiveType {\n  TEXT,\n  ATTRIBUTE,\n  ATTRIBUTE_VALUE,\n}\nexport interface DirectiveData {\n  d: Function;\n  t?: DirectiveType;\n  a?: string;\n  n?: Node;\n  c?: () => void;\n}\nconst insertAttributeMarker = (\n  marker: string,\n  si: number,\n  appendedStatic: string\n): string => {\n  while (si++) {\n    const char = appendedStatic.charAt(si);\n    if (!char) {\n      break;\n    }\n    if (char === ' ') {\n      return (\n        appendedStatic.slice(0, si) + ' ' + marker + appendedStatic.slice(si)\n      );\n    }\n  }\n  return appendedStatic;\n};\nexport const getTextMarker = (id: number): string => {\n  return `tm-${id}`;\n};\nexport const getAttributeMarker = (id: number): string => {\n  return `data-am-${id}`;\n};\nexport interface HTMLResult {\n  template: HTMLTemplateElement;\n  directives: DirectiveData[];\n}\nlet resultCache: WeakMap<TemplateStringsArray, HTMLResult> = new WeakMap();\nexport const html = (\n  staticParts: TemplateStringsArray,\n  ...dynamicParts: any[]\n): HTMLResult => {\n  let result: HTMLResult = resultCache.get(staticParts);\n  if (!result) {\n    let appendedStatic: string = '';\n    const directives: DirectiveData[] = [];\n    for (let i = 0; i < dynamicParts.length; i++) {\n      const dynamicPart = dynamicParts[i];\n      const staticPart = staticParts[i];\n      appendedStatic += staticPart;\n      if (typeof dynamicPart !== 'function') {\n        appendedStatic += dynamicPart;\n        continue;\n      }\n      let id =\n        directives.push({\n          d: dynamicPart,\n        }) - 1;\n      let si = appendedStatic.length + 1;\n      let attributeValueMode = false;\n      let attributeMode = false;\n      let attributeNameFound = false;\n      let attributeName = '';\n      while (si--) {\n        const char = appendedStatic.charAt(si);\n        const nextChar = appendedStatic.charAt(si - 1);\n        const nextNextChar = appendedStatic.charAt(si - 2);\n        if (char === '>' || si === 0) {\n          let marker = getTextMarker(id);\n          appendedStatic += `<${marker}>&zwnj;</${marker}>`;\n          directives[id].t = DirectiveType.TEXT;\n          break;\n        }\n        if (\n          char === '\"' &&\n          nextChar === '=' &&\n          isLetter(nextNextChar) &&\n          !attributeMode\n        ) {\n          attributeValueMode = true;\n          continue;\n        }\n        if (char === '\"' && nextNextChar !== '=' && !attributeValueMode) {\n          attributeValueMode = false;\n          attributeMode = true;\n          continue;\n        }\n        if (\n          attributeValueMode &&\n          char !== '\"' &&\n          char !== '=' &&\n          !attributeNameFound\n        ) {\n          if (char !== ' ') {\n            attributeName = char + attributeName;\n          } else {\n            attributeNameFound = true;\n          }\n        }\n        if (char === '<' && attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE_VALUE;\n          directives[id].a = attributeName;\n          if (appendedStatic[appendedStatic.length - 1] === ' ') {\n            appendedStatic = appendedStatic.slice(0, appendedStatic.length - 1);\n          }\n          break;\n        }\n        if (char === '<' && !attributeValueMode) {\n          appendedStatic = insertAttributeMarker(\n            getAttributeMarker(id),\n            si,\n            appendedStatic\n          );\n          directives[id].t = DirectiveType.ATTRIBUTE;\n          break;\n        }\n      }\n    }\n    appendedStatic += staticParts[staticParts.length - 1];\n    const template = document.createElement('template');\n    template.innerHTML = appendedStatic;\n    result = {\n      template,\n      directives,\n    };\n  } else {\n    let directiveIndex: number = 0;\n    dynamicParts.forEach((value: any) => {\n      if (typeof value === 'function') {\n        result.directives[directiveIndex].d = value;\n        directiveIndex++;\n      }\n    });\n  }\n  resultCache.set(staticParts, result);\n  return result;\n};\n","import {\n  HTMLResult,\n  DirectiveType,\n  getTextMarker,\n  getAttributeMarker,\n} from './html';\n\nconst childNodesMap: WeakMap<HTMLElement, NodeList> = new WeakMap();\nexport const render = (\n  container: HTMLElement,\n  htmlResult: HTMLResult\n): void => {\n  let fragment: DocumentFragment;\n  if (!childNodesMap.has(container)) {\n    fragment = htmlResult.template.content.cloneNode(true) as DocumentFragment;\n    htmlResult.directives.forEach((directiveData, id) => {\n      switch (directiveData.t) {\n        case DirectiveType.TEXT:\n          const placeholder = fragment.querySelector(getTextMarker(id));\n          const textNode = placeholder.firstChild;\n          directiveData.n = textNode;\n          placeholder.parentElement.replaceChild(textNode, placeholder);\n          break;\n        case DirectiveType.ATTRIBUTE:\n        case DirectiveType.ATTRIBUTE_VALUE:\n          const marker = getAttributeMarker(id);\n          const node = fragment.querySelector(`[${marker}]`);\n          node.removeAttribute(marker);\n          directiveData.n = node;\n      }\n    });\n    childNodesMap.set(container, fragment.childNodes);\n  }\n  htmlResult.directives.forEach(directiveData => {\n    directiveData.d(directiveData.n);\n  });\n  if (fragment) {\n    container.appendChild(fragment);\n  }\n};\n","const IS_PROXY = Symbol('$P');\nfunction proxify(obj: any, onChange: () => void): any {\n  const proxy = new Proxy(obj, {\n    get: (obj, prop) => {\n      if (\n        obj[prop] &&\n        typeof obj[prop] === 'object' &&\n        obj[prop].__$p !== IS_PROXY\n      ) {\n        obj[prop] = proxify(obj[prop], onChange);\n      }\n      return obj[prop];\n    },\n    set: (obj, prop, value) => {\n      if (obj[prop] !== value && prop !== '__$p') {\n        obj[prop] = value;\n        onChange();\n      }\n      return true;\n    },\n  });\n  proxy.__$p = IS_PROXY;\n  return proxy;\n}\nlet onStateChanged: () => void;\nexport const setUpState = <CB extends () => any>(\n  cb: CB,\n  onChange: () => void\n): ReturnType<CB> => {\n  onStateChanged = onChange;\n  let result = cb();\n  onStateChanged = undefined;\n  return result;\n};\nexport const $state = <S extends {} = {}>(initialState: Partial<S> = {}): S => {\n  let onChange = onStateChanged;\n  return proxify(initialState, () => onChange && onChange());\n};\n","export enum PriorityLevel {\n  IMMEDIATE = 0, //synchronous\n  USER_BLOCKING = 250, //.25s timeout\n  NORMAL = 5000, // 5s timeout\n  LOW = 10000, // 10s timeout\n  IDLE = 99999999, // no timeout (run only when nothing else is scheduled)\n}\ntype ScheduledJob = [() => void, number];\nlet scheduledJobs: ScheduledJob[] = [];\nlet schedulerRunning: boolean = false;\nconst MAX_ELAPSED: number = 17;\nconst processJobQueue = (\n  queue: ScheduledJob[],\n  now: number\n): ScheduledJob[] => {\n  return queue.filter(([cb, latestEndTime]) => {\n    const totalElapsed: number = Date.now() - now;\n    if (now >= latestEndTime || totalElapsed < MAX_ELAPSED) {\n      cb();\n      return false;\n    } else {\n      return true;\n    }\n  });\n};\nconst processScheduledJobs = () => {\n  const now: number = Date.now();\n  const jobsToRun = scheduledJobs;\n  scheduledJobs = [];\n  const remainingJobs = processJobQueue(\n    jobsToRun.sort((a, b) => (a[1] < b[1] ? -1 : 1)),\n    now\n  );\n  scheduledJobs = remainingJobs.concat(scheduledJobs);\n  if (scheduledJobs.length > 0) {\n    requestAnimationFrame(processScheduledJobs);\n  } else {\n    schedulerRunning = false;\n  }\n};\nexport const schedule = (\n  cb: () => void,\n  priority: PriorityLevel = PriorityLevel.NORMAL\n): Promise<void> => {\n  if (priority === PriorityLevel.IMMEDIATE) {\n    cb();\n  } else {\n    return new Promise(resolve => {\n      scheduledJobs.push([\n        () => {\n          cb();\n          resolve();\n        },\n        Date.now() + priority,\n      ]);\n      if (!schedulerRunning) {\n        requestAnimationFrame(processScheduledJobs);\n        schedulerRunning = true;\n      }\n    });\n  }\n  return Promise.resolve();\n};\nexport type Schedule = typeof schedule;\n","export const getOnlySetupError = (subject: string): string =>\n  `${subject} can only be used during setup!`;\n","import { getOnlySetupError } from './misc';\n\nconst global: { __$c: HTMLElement } = window as any;\n\nexport const setUpContext = (context: HTMLElement, cb: () => void): void => {\n  global.__$c = context;\n  cb();\n  global.__$c = undefined;\n};\n\nexport const getElement = (): HTMLElement => {\n  if (global.__$c) {\n    return global.__$c;\n  } else {\n    throw getOnlySetupError('getElement');\n  }\n};\n","import { getElement } from './context';\nimport { schedule, PriorityLevel } from './scheduler';\n\nexport type CleanUp = () => void;\nexport type SideEffect = () => void | CleanUp;\ninterface SideEffectsMapItem {\n  e: SideEffect;\n  d?: () => any[];\n  p?: any[];\n  c?: CleanUp;\n}\nconst sideEffectsMap: WeakMap<\n  HTMLElement,\n  SideEffectsMapItem[]\n> = new WeakMap();\n\nexport const sideEffect = (effect: () => void, dependencies?: () => any[]) => {\n  const element = getElement();\n  sideEffectsMap.set(\n    element,\n    (sideEffectsMap.get(element) || []).concat({\n      e: effect,\n      d: dependencies,\n    })\n  );\n};\nconst shouldEffectRun = (effectMapItem: SideEffectsMapItem): boolean => {\n  const { d, p } = effectMapItem;\n  let shouldRun: boolean = true;\n  if (d) {\n    const deps = d();\n    if (\n      p &&\n      (deps === p ||\n        (deps.length === p.length &&\n          deps.findIndex((dep, index) => p[index] !== dep))) === -1\n    ) {\n      shouldRun = false;\n    }\n  }\n  return shouldRun;\n};\nexport const runSideEffects = (element: HTMLElement): Promise<void[]> => {\n  const sideEffects = sideEffectsMap.get(element) || [];\n  if (sideEffects.length > 0) {\n    return Promise.all(\n      sideEffects\n        .map(effectMapItem => {\n          const { c } = effectMapItem;\n          if (c && shouldEffectRun(effectMapItem)) {\n            return schedule(() => {\n              c();\n              effectMapItem.c = undefined;\n            }, PriorityLevel.USER_BLOCKING);\n          }\n          return undefined;\n        })\n        .filter(p => p)\n    ).then(() =>\n      Promise.all(\n        sideEffects\n          .map(effectMapItem => {\n            const { e, d } = effectMapItem;\n            let shouldRun: boolean = shouldEffectRun(effectMapItem);\n            if (d) {\n              effectMapItem.p = d();\n            }\n            if (shouldRun) {\n              return schedule(() => {\n                const cleanUp = e();\n                if (cleanUp) {\n                  effectMapItem.c = cleanUp;\n                }\n              }, PriorityLevel.USER_BLOCKING);\n            }\n            return undefined;\n          })\n          .filter(p => p)\n      )\n    );\n  } else {\n    return Promise.resolve([]);\n  }\n};\n","import { HTMLResult } from './html';\nimport { setUpState } from './reactivity';\nimport { render } from './render';\nimport { schedule, PriorityLevel } from './scheduler';\nimport { setUpContext } from './context';\nimport { runSideEffects } from './sideeffects';\nexport interface ComponentDefinition {\n  render: () => HTMLResult;\n}\nexport type Setup = () => ComponentDefinition;\nexport const component = (name: string, setup: Setup) => {\n  customElements.define(\n    name,\n    class extends HTMLElement {\n      private renderQueued: boolean = false;\n      private nextRenderQueued: boolean = false;\n      private render: () => HTMLResult;\n      constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n\n        setUpContext(this, () =>\n          setUpState(\n            () => (this.render = setup().render),\n            () => {\n              this.performRender();\n            }\n          )\n        );\n        this.performRender();\n      }\n\n      private performRender() {\n        if (!this.renderQueued) {\n          this.renderQueued = true;\n          schedule(() => {\n            render(this.shadowRoot as any, this.render());\n          }, PriorityLevel.USER_BLOCKING)\n            .then(async () => await runSideEffects(this))\n            .then(() => {\n              this.renderQueued = false;\n              if (this.nextRenderQueued) {\n                this.nextRenderQueued = false;\n                this.performRender();\n              }\n            });\n        } else {\n          this.nextRenderQueued = true;\n        }\n      }\n    }\n  );\n};\n","import { getElement } from './context';\nimport { $state } from './reactivity';\n\nexport const $prop = <T>(name: string, initialValue: T): { value: T } => {\n  const element = getElement() as any;\n  const state = $state({ value: initialValue });\n  Object.defineProperty(element, name, {\n    get: () => state.value,\n    set: (value: any) => {\n      state.value = value;\n    },\n  });\n  return state;\n};\n","import { $state } from './reactivity';\nimport { getElement } from './context';\nimport { sideEffect } from './sideeffects';\n\nconst attributeCallbackMap: WeakMap<\n  HTMLElement,\n  { [key: string]: (() => void)[] }\n> = new Map();\nconst observerMap: WeakMap<HTMLElement, MutationObserver> = new WeakMap();\n\nconst addObserver = (element: HTMLElement): void => {\n  if (!observerMap.has(element)) {\n    const observer = new MutationObserver((mutationsList: MutationRecord[]) => {\n      for (const mutation of mutationsList) {\n        if (mutation.type === 'attributes') {\n          const callbacks =\n            (attributeCallbackMap.get(element) || {})[mutation.attributeName] ||\n            [];\n          callbacks.forEach(cb => cb());\n        }\n      }\n    });\n    observerMap.set(element, observer);\n  }\n};\n\nconst startObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).observe(element, { attributes: true });\n  }\n};\n\nconst stopObserving = (element: HTMLElement) => {\n  if (observerMap.has(element)) {\n    observerMap.get(element).disconnect();\n  }\n};\n\nconst observeAttribute = (\n  element: HTMLElement,\n  name: string,\n  cb: () => void\n): void => {\n  if (!attributeCallbackMap.has(element)) {\n    attributeCallbackMap.set(element, {});\n  }\n  if (!attributeCallbackMap.get(element)[name]) {\n    attributeCallbackMap.get(element)[name] = [];\n  }\n  attributeCallbackMap.get(element)[name].push(cb);\n};\n\nexport const $attr = (\n  name: string,\n  initialValue: string = ''\n): { value: string } => {\n  const element = getElement();\n  addObserver(element);\n  observeAttribute(element, name, () => {\n    const value = element.getAttribute(name);\n    if (state.value !== value) {\n      state.value = element.getAttribute(name);\n    }\n  });\n\n  element.setAttribute(name, initialValue);\n\n  const state = $state({ value: element.getAttribute(name) });\n\n  sideEffect(\n    () => {\n      stopObserving(element);\n      element.setAttribute(name, state.value);\n      startObserving(element);\n    },\n    () => [state.value]\n  );\n\n  return state;\n};\n","import { schedule, Schedule } from './scheduler';\n\nexport type Directive<N extends Node = Node, Args extends any[] = any[]> = (\n  ...args: Args\n) => (node: N) => void;\nexport type DirectiveHandler<\n  N extends Node = any,\n  Args extends any[] = any[]\n> = (node: N, schedule: Schedule, ...args: Args) => void;\nexport function createDirective<\n  Args extends any[] = any[],\n  N extends Node = any,\n  D extends DirectiveHandler<N, Args> = DirectiveHandler<N, Args>\n>(\n  handler: D\n): D extends (node: N, schedule: Schedule, ...args: infer A) => void\n  ? Directive<N, A>\n  : never {\n  return ((...args: Args) => {\n    return (node: N) => {\n      handler(node, schedule, ...args);\n    };\n  }) as D extends (node: N, schedule: Schedule, ...args: infer A) => void\n    ? Directive<N, A>\n    : never;\n}\n","import { createDirective } from '../directive';\nimport { Schedule, PriorityLevel } from '../scheduler';\n\nexport const text = createDirective(\n  (node: Text, schedule: Schedule, value: string) => {\n    if (node instanceof Text) {\n      schedule(() => {\n        node.textContent = value;\n      }, PriorityLevel.IMMEDIATE);\n    }\n  }\n);\n","import { createDirective } from '../directive';\nimport { PriorityLevel, Schedule } from '../scheduler';\n\nconst handlerMap: WeakMap<HTMLInputElement, string[]> = new WeakMap();\nexport const onHandler = (\n  node: HTMLInputElement,\n  schedule: Schedule,\n  name: string,\n  cb: <E extends Event>(e: E) => void\n) => {\n  if (node instanceof HTMLInputElement) {\n    if (!handlerMap.has(node) && !(handlerMap.get(node) || []).includes(name)) {\n      handlerMap.set(\n        node,\n        [].concat(name, handlerMap.get(node)).filter(n => n)\n      );\n      node.addEventListener(name, e => {\n        schedule(() => cb(e), PriorityLevel.IMMEDIATE);\n      });\n    }\n  }\n};\nexport const on = createDirective(onHandler);\n","import { createDirective } from '../directive';\nimport { Schedule, PriorityLevel } from '../scheduler';\nimport { onHandler } from './on';\n\nexport const input = createDirective(\n  (node: HTMLInputElement, schedule: Schedule, cb: (value: string) => void) =>\n    onHandler(node, schedule, 'input', e => {\n      const value: string = (e.target as HTMLInputElement).value;\n      schedule(() => cb(value), PriorityLevel.USER_BLOCKING);\n    })\n);\n"],"names":["isLetter","c","toLowerCase","toUpperCase","DirectiveType","insertAttributeMarker","marker","si","appendedStatic","char","charAt","slice","getTextMarker","id","getAttributeMarker","resultCache","WeakMap","html","staticParts","result","get","dynamicParts","directives","i","length","dynamicPart","staticPart","push","d","attributeValueMode","attributeMode","attributeNameFound","attributeName","nextChar","nextNextChar","t","TEXT","ATTRIBUTE_VALUE","a","ATTRIBUTE","template","document","createElement","innerHTML","directiveIndex","forEach","value","set","childNodesMap","render","container","htmlResult","fragment","has","content","cloneNode","directiveData","placeholder","querySelector","textNode","firstChild","n","parentElement","replaceChild","node","removeAttribute","childNodes","appendChild","IS_PROXY","Symbol","proxify","obj","onChange","proxy","Proxy","prop","__$p","onStateChanged","setUpState","cb","undefined","$state","initialState","PriorityLevel","scheduledJobs","schedulerRunning","MAX_ELAPSED","processJobQueue","queue","now","filter","latestEndTime","totalElapsed","Date","processScheduledJobs","jobsToRun","remainingJobs","sort","b","concat","requestAnimationFrame","schedule","priority","NORMAL","IMMEDIATE","Promise","resolve","getOnlySetupError","subject","global","window","setUpContext","context","__$c","getElement","sideEffectsMap","sideEffect","effect","dependencies","element","e","shouldEffectRun","effectMapItem","p","shouldRun","deps","findIndex","dep","index","runSideEffects","sideEffects","all","map","USER_BLOCKING","then","cleanUp","component","name","setup","customElements","define","attachShadow","mode","performRender","renderQueued","shadowRoot","nextRenderQueued","HTMLElement","$prop","initialValue","state","Object","defineProperty","attributeCallbackMap","Map","observerMap","addObserver","observer","MutationObserver","mutationsList","mutation","type","callbacks","startObserving","observe","attributes","stopObserving","disconnect","observeAttribute","$attr","getAttribute","setAttribute","createDirective","handler","args","text","Text","textContent","handlerMap","onHandler","HTMLInputElement","includes","addEventListener","on","input","target"],"mappings":"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"}